# ğŸ“¦ Requirements: Material Management (Quáº£n LÃ½ Váº­t TÆ°)

> **ğŸ“‹ STATUS: PENDING** - Giai Ä‘oáº¡n 1, TÃ­nh nÄƒng 3  
> **ğŸ”— Parent**: `015 Inventory - Overview.md`  
> **ğŸ“„ Implementation**: `src/features/materials/`  
> **âš ï¸ Dependencies**: `015.1 Master Data.md` (categories: 'don-vi-tinh', 'loai-vat-tu', 'bo-mon', 'nhom-vat-tu', 'phan-nhom-vat-tu', 'tag-vat-tu')

## ğŸ¯ Má»¥c TiÃªu

Quáº£n lÃ½ danh má»¥c hÃ ng hÃ³a/váº­t tÆ° trong kho cho module Inventory. Sá»­ dá»¥ng pattern tÆ°Æ¡ng tá»± Supplier vÃ  Dental Service: PageView + Table + FormModal, React Hook Form + Zod, Server Actions cho mutations.

## ğŸ“Š Database Model

```prisma
model Material {
  id              String   @id @default(uuid())
  code            String   @unique  // MAT0001, MAT0002... (Tá»± sinh)
  name            String   @unique
  description     String?  // MÃ´ táº£, quy cÃ¡ch Ä‘Ã³ng gÃ³i

  // Store MasterData.key (String), NOT id (UUID)
  // NO FK relation â†’ Allows MasterData to be deleted
  // Frontend: Display MasterData.value if found, else display key itself
  unit            String    // ÄÆ¡n vá»‹ tÃ­nh (category='don-vi-tinh') - Required
  materialType    String    // Loáº¡i váº­t tÆ° (category='loai-vat-tu') - Required
  department      String    // Bá»™ mÃ´n (category='bo-mon') - Required
  category        String?   // NhÃ³m váº­t tÆ° (category='nhom-vat-tu')
  subCategory     String?   // PhÃ¢n nhÃ³m (category='phan-nhom-vat-tu')

  minStockLevel   Int?     // Má»©c tá»“n kho tá»‘i thiá»ƒu
  imageUrl        String?  // URL hÃ¬nh áº£nh
  tags            String[] // Array of MasterData keys (category='tag-vat-tu')

  archivedAt      DateTime? @db.Timestamptz  // Soft delete
  createdAt       DateTime  @default(now()) @db.Timestamptz
  updatedAt       DateTime  @updatedAt @db.Timestamptz

  createdById     String // ID cá»§a ngÆ°á»i táº¡o
  updatedById     String // ID cá»§a ngÆ°á»i cáº­p nháº­t

  createdBy       Employee @relation("CreatedMaterials", fields: [createdById], references: [id])
  updatedBy       Employee @relation("UpdatedMaterials", fields: [updatedById], references: [id])

  // Relations (placeholder - sáº½ Ä‘Æ°á»£c thÃªm khi implement Goods Receipt/Issue)
  // receiptDetails  GoodsReceiptDetail[]
  // issueDetails    GoodsIssueDetail[]
  // stockQuants     StockQuant[]

  @@index([code])
  @@index([name])
  @@index([materialType, department, category, archivedAt])
  @@index([tags]) // GIN index for array search in PostgreSQL
  @@map("materials")
}
```

**Ghi chÃº mÃ´ hÃ¬nh:**

- DÃ¹ng `archivedAt DateTime?` Ä‘á»ƒ soft-delete (Ä‘á»“ng bá»™ vá»›i Supplier/Dental Service pattern)
- `createdById`, `updatedById` track audit trail (tÆ°Æ¡ng tá»± Supplier/Dental Service)
- `code` tá»± Ä‘á»™ng sinh (MAT0001, MAT0002...) tÆ°Æ¡ng tá»± pattern Supplier
- Tags: Array of MasterData keys (category='tag-vat-tu') Ä‘á»ƒ chuáº©n hÃ³a vÃ  tÃ¡i sá»­ dá»¥ng

**Design Decision: Store `key` (String) instead of FK**

- âœ… Semantic & Portable: Store `'cai'`, `'tieu-hao'` instead of UUID
- âœ… No FK constraint â†’ Master Data can be deleted without blocking
- âœ… Frontend handles gracefully: Display `value` if found, else display `key`
- âœ… Immutable `key` â†’ Stable reference

---

## ğŸ¯ Core Requirements

### 1. â• Táº¡o Váº­t TÆ° (Create)

#### ğŸ” Permissions

- Chá»‰ **Admin** má»›i Ä‘Æ°á»£c táº¡o váº­t tÆ°
- **Employee khÃ´ng cÃ³ quyá»n truy cáº­p** feature nÃ y
- Kiá»ƒm tra quyá»n á»Ÿ cáº£ client (hide menu/button) vÃ  server

#### ğŸ¨ UI/UX

- **Modal form** responsive (85% width mobile, 65% width desktop)
- **Real-time validation** vá»›i error feedback
- **Auto-generate code**: MAT0001, MAT0002... (read-only display)

#### ğŸ“ Form Layout (5 hÃ ng)

```
HÃ ng 1: [name (50%)              ] [unit (25%)  ] [code (25%, read-only)]
HÃ ng 2: [materialType (50%)      ] [department (50%)                    ]
HÃ ng 3: [category (50%)          ] [subCategory (50%)                   ]
HÃ ng 4: [minStockLevel (25%)     ] [imageUrl (25%)] [tags (50%)        ]
HÃ ng 5: [description (100%, 2 rows)                                     ]
```

**Ghi chÃº:**

- `code`: Auto-generated, read-only display
- `unit`, `materialType`, `department`, `category`, `subCategory`: Chá»n tá»« MasterData tÆ°Æ¡ng á»©ng hoáº·c Ä‘á»ƒ trá»‘ng
- `tags`: Select mode="multiple" chá»n tá»« MasterData (category='tag-vat-tu')
- `archivedAt` khÃ´ng hiá»ƒn thá»‹ trong Create; chá»‰ hiá»ƒn thá»‹ read-only á»Ÿ Edit khi Ä‘Ã£ bá»‹ lÆ°u trá»¯

#### âœ… Validation Rules

- `name`: Required, unique, 2-200 kÃ½ tá»±
- `code`: Auto-generated, unique (MAT0001, MAT0002...)
- `unit`: Required, select from MasterData (category = 'don-vi-tinh')
- `materialType`: Required, select from MasterData (category = 'loai-vat-tu')
- `department`: Required, select from MasterData (category = 'bo-mon')
- `category`: Optional, select from MasterData (category = 'nhom-vat-tu')
- `subCategory`: Optional, select from MasterData (category = 'phan-nhom-vat-tu')
- `description`: Optional, max 1000 kÃ½ tá»±
- `minStockLevel`: Optional, Int >= 0
- `imageUrl`: Optional, valid URL format
- `tags`: Array of MasterData keys, select from category='tag-vat-tu', max 20 tags

---

### 2. ğŸ“‹ Danh SÃ¡ch Váº­t TÆ° (List)

#### ğŸ” Permissions

- Chá»‰ **Admin** má»›i Ä‘Æ°á»£c xem danh sÃ¡ch váº­t tÆ°
- **Employee**: Hide menu item trong sidebar

#### ğŸ“Š Table Features

- KhÃ´ng phÃ¢n trang (dataset trung bÃ¬nh, tÆ°Æ¡ng tá»± Supplier/Dental Service)
- KhÃ´ng search backend. Sá»­ dá»¥ng filter/sorter sáºµn cÃ³ cá»§a AntD Table á»Ÿ frontend
- Filter theo cá»™t: Loáº¡i VT (`materialType`), Bá»™ mÃ´n (`department`), NhÃ³m (`category`)
- Sorter theo cá»™t: TÃªn VT (`name`), MÃ£ VT (`code`)
- Toggle "Hiá»ƒn thá»‹ archived" â€” param `includeArchived=0|1` khi gá»i API
- Action buttons: Edit, Archive/Unarchive, Delete (kÃ¨m tooltips + Popconfirm)

#### ğŸ—‚ï¸ Table Columns

| Column        | Width | Type    | Description                       |
| ------------- | ----- | ------- | --------------------------------- |
| MÃ£ VT         | 120px | Text    | `code` (Sorter)                   |
| TÃªn váº­t tÆ°    | Auto  | Text    | `name` (Sorter)                   |
| ÄVT           | 100px | Text    | `unit`                            |
| Loáº¡i VT       | 140px | Text    | `materialType` (Filter)           |
| Bá»™ mÃ´n        | 140px | Text    | `department` (Filter)             |
| NhÃ³m VT       | 140px | Text    | `category` (Filter)               |
| Tá»“n tá»‘i thiá»ƒu | 120px | Number  | `minStockLevel`                   |
| Tráº¡ng thÃ¡i    | 120px | Tag     | Active/Archived (tá»« `archivedAt`) |
| Tags          | Auto  | Tags    | `tags` (first 3, +N more)         |
| Thao tÃ¡c      | 180px | Actions | Edit/Archive/Unarchive/Delete     |

#### ğŸ”§ Components

- `MaterialTable.tsx` â€” reusable table component
- `MaterialsPageView.tsx` â€” page wrapper (filters/sorters + toggle + table + create button)

---

### 3. âœï¸ Chá»‰nh Sá»­a Váº­t TÆ° (Edit)

#### ğŸ¨ UI/UX

- DÃ¹ng chung modal nhÆ° Create
- Pre-populate dá»¯ liá»‡u theo item Ä‘Æ°á»£c chá»n
- Hiá»ƒn thá»‹ admin metadata: `code` (read-only), `createdAt`, `updatedAt`, `archivedAt` (read-only)

#### ğŸ”„ Behavior

- Cho phÃ©p chá»‰nh sá»­a táº¥t cáº£ fields trá»« `code` vÃ  `archivedAt` (chá»‰ thay Ä‘á»•i qua action Archive/Unarchive)
- Unique validation cho `name` (exclude current record)
- Success feedback + auto-close modal + invalidate list/detail queries

---

### 4. ğŸ—„ï¸ Archive/Delete Operations

#### ğŸ“¦ Archive System (Ä‘á»“ng bá»™ Supplier/Dental Service)

- Soft delete báº±ng `archivedAt` timestamp
- Archive: set `archivedAt = now()`
- Unarchive: set `archivedAt = null`

#### âŒ Delete Logic

```typescript
if (hasLinkedData) {
  throw new Error("Váº­t tÆ° Ä‘ang cÃ³ dá»¯ liá»‡u liÃªn káº¿t, chá»‰ Ä‘Æ°á»£c phÃ©p Archive");
} else {
  // Hard delete allowed
}
```

Linked data bao gá»“m:

- `GoodsReceiptDetail.materialId` (tÆ°Æ¡ng lai)
- `GoodsIssueDetail.materialId` (tÆ°Æ¡ng lai)
- CÃ¡c liÃªn káº¿t khÃ¡c vá»›i inventory

#### ğŸ¨ UI Actions

- Archive button: `<InboxOutlined />` â€” LÆ°u trá»¯
- Unarchive button: `<RollbackOutlined />` â€” KhÃ´i phá»¥c
- Delete button: `<DeleteOutlined />` + Popconfirm

---

### 5. ğŸ“ Layout Integration

#### Sidebar Navigation

- **Menu Group**: "Quáº£n lÃ½ kho" (Inventory Management)
  - Icon: `<InboxOutlined />` hoáº·c `<AppstoreOutlined />`
  - Visibility: Admin only
- **Submenu Item**: "Danh má»¥c váº­t tÆ°"
  - Route: `/inventory/materials`
  - Icon: `<BoxPlotOutlined />` hoáº·c `<ProfileOutlined />`
  - Visibility: Admin only
  - Label: "Danh má»¥c váº­t tÆ°" hoáº·c "Váº­t tÆ°"

---

## ğŸ”§ Technical Implementation

### API Endpoints

```
GET    /api/v1/materials?includeArchived=0|1
GET    /api/v1/materials/:id
```

**Ghi chÃº:**

- KhÃ´ng há»— trá»£ search backend. Lá»c/sáº¯p xáº¿p thá»±c hiá»‡n táº¡i frontend dá»±a trÃªn dá»¯ liá»‡u Ä‘Ã£ táº£i
- `includeArchived` = 0 (máº·c Ä‘á»‹nh) chá»‰ tráº£ vá» Active; = 1 tráº£ vá» cáº£ Archived
- POST, PUT, DELETE removed - Use Server Actions instead

### API Client

```typescript
// src/features/materials/api.ts

/**
 * Get materials list
 * GET /api/v1/materials
 * @param includeArchived - Include archived materials in the list
 * @returns Array of materials
 */
export async function getMaterialsApi(includeArchived: boolean);

/**
 * Get material detail by ID
 * GET /api/v1/materials/[id]
 * @param id - Material ID
 * @returns Full material detail
 */
export async function getMaterialByIdApi(id: string);

/**
 * Get next material code
 * Utility function for auto-generating material code
 * @returns Next available code (e.g., MAT0001)
 */
export async function getNextMaterialCodeApi(): Promise<string>;
```

### Server Actions

```typescript
// src/server/actions/material.actions.ts

/**
 * Server Action: Create new material
 * Usage: const result = await createMaterialAction(data);
 */
export async function createMaterialAction(data: CreateMaterialRequest);

/**
 * Server Action: Update existing material
 * Usage: const result = await updateMaterialAction(materialId, data);
 */
export async function updateMaterialAction(
  materialId: string,
  data: UpdateMaterialRequest
);

/**
 * Server Action: Delete material (hard delete - permanently remove)
 * Usage: await deleteMaterialAction(id);
 */
export async function deleteMaterialAction(materialId: string);

/**
 * Server Action: Archive material (soft delete)
 * Usage: await archiveMaterialAction(id);
 */
export async function archiveMaterialAction(materialId: string);

/**
 * Server Action: Unarchive material (restore)
 * Usage: await unarchiveMaterialAction(id);
 */
export async function unarchiveMaterialAction(materialId: string);
```

### Architecture

```
UI Components + Custom Hooks + API Client + Routes + Services + Repository + Database
```

### State Management

- React Query cho server state
- Query keys: `['materials', { includeArchived }]`, `['material', id]`

### Service Layer

```typescript
// src/server/services/material.service.ts

export const materialService = {
  async list(currentUser: UserCore | null, includeArchived: boolean),
  async getById(currentUser: UserCore | null, id: string),
  async create(currentUser: UserCore | null, body: unknown),
  async update(currentUser: UserCore | null, body: unknown),
  async remove(currentUser: UserCore | null, id: string),
  async archive(currentUser: UserCore | null, id: string),
  async unarchive(currentUser: UserCore | null, id: string),
  async generateNextCode(): Promise<string>, // Utility for auto-code generation
};
```

**Business Logic:**

- `create`: requireAdmin, validate unique name, auto-generate code, track createdById/updatedById
- `update`: requireAdmin, validate unique name (exclude current), track updatedById
- `remove`: requireAdmin, check linked data (GoodsReceiptDetails, GoodsIssueDetails), throw error if exists
- `archive/unarchive`: requireAdmin, set archivedAt timestamp
- `generateNextCode`: Query last code, increment (MAT0001 â†’ MAT0002)

### Validation Stack

- Client: React Hook Form + Zod resolver
- Server: Zod schemas táº¡i `src/shared/validation/material.schema.ts`
- Database: Prisma constraints (unique code, unique name, archivedAt soft-delete)

---

## âœ… Validation (Zod Schema)

```typescript
// src/shared/validation/material.schema.ts
import { z } from "zod";

/**
 * Material Base Schema
 * DÃ¹ng lÃ m ná»n cho CreateMaterialRequestSchema vÃ  UpdateMaterialRequestSchema
 */
export const MaterialBaseSchema = z.object({
  code: z.string().regex(/^MAT\d{4}$/, "MÃ£ váº­t tÆ° khÃ´ng há»£p lá»‡"),
  name: z.string().trim().min(2, "TÃªn váº­t tÆ° lÃ  báº¯t buá»™c").max(200),
  description: z.string().trim().max(1000).optional().nullable(),

  // MasterData keys
  unit: z.string().trim().min(1, "ÄÆ¡n vá»‹ tÃ­nh lÃ  báº¯t buá»™c"),
  materialType: z.string().trim().min(1, "Loáº¡i váº­t tÆ° lÃ  báº¯t buá»™c"),
  department: z.string().trim().min(1, "Bá»™ mÃ´n lÃ  báº¯t buá»™c"),
  category: z.string().trim().optional().nullable(),
  subCategory: z.string().trim().optional().nullable(),

  minStockLevel: z
    .number()
    .int()
    .min(0, "Tá»“n kho tá»‘i thiá»ƒu khÃ´ng Ä‘Æ°á»£c Ã¢m")
    .optional()
    .nullable(),
  imageUrl: z
    .string()
    .url("URL khÃ´ng há»£p lá»‡")
    .optional()
    .nullable()
    .or(z.literal("")),
  tags: z
    .array(z.string()) // Array of MasterData keys from category='tag-vat-tu'
    .max(20, "KhÃ´ng Ä‘Æ°á»£c quÃ¡ 20 tags")
    .optional()
    .default([]),

  archivedAt: z.date().optional().nullable(),
});

/**
 * Create Material Request Schema
 * DÃ¹ng á»Ÿ: Form create material (admin)
 * Omit code (server tá»± generate), archivedAt (server tá»± set khi archive)
 */
export const CreateMaterialRequestSchema = MaterialBaseSchema.omit({
  code: true,
  archivedAt: true,
});

/**
 * Update Material Request Schema
 * DÃ¹ng á»Ÿ: Form edit material (admin)
 * Cho phÃ©p cáº­p nháº­t táº¥t cáº£ fields trá»« code
 */
export const UpdateMaterialRequestSchema = MaterialBaseSchema.omit({
  code: true,
}).extend({
  id: z.string().uuid("ID khÃ´ng há»£p lá»‡"),
});

/**
 * Material Response Schema
 * DÃ¹ng á»Ÿ: Service layer validate response trÆ°á»›c khi tráº£ vá» API
 */
export const MaterialResponseSchema = z.object({
  id: z.string().uuid(),
  code: z.string(),
  name: z.string(),
  description: z.string().nullable().optional(),
  unit: z.string(),
  materialType: z.string(),
  department: z.string(),
  category: z.string().nullable().optional(),
  subCategory: z.string().nullable().optional(),
  minStockLevel: z.number().nullable().optional(),
  imageUrl: z.string().nullable().optional(),
  tags: z.array(z.string()).optional(),
  archivedAt: z.string().datetime().nullable().optional(),
  createdById: z.string().uuid(),
  updatedById: z.string().uuid(),
  createdAt: z.string().datetime(),
  updatedAt: z.string().datetime(),
  // Nested objects
  createdBy: z
    .object({
      id: z.string().uuid(),
      fullName: z.string(),
    })
    .nullable()
    .optional(),
  updatedBy: z
    .object({
      id: z.string().uuid(),
      fullName: z.string(),
    })
    .nullable()
    .optional(),
});

export const MaterialsResponseSchema = z.array(MaterialResponseSchema);

// TypeScript types
export type CreateMaterialRequest = z.infer<typeof CreateMaterialRequestSchema>;
export type UpdateMaterialRequest = z.infer<typeof UpdateMaterialRequestSchema>;
export type MaterialResponse = z.infer<typeof MaterialResponseSchema>;
export type MaterialsResponse = z.infer<typeof MaterialsResponseSchema>;
```

---

## ğŸ“‹ Constants

```typescript
// src/features/materials/constants.ts

export const MATERIAL_ENDPOINTS = {
  ROOT: "/api/v1/materials",
  BY_ID: (id: string) => `/api/v1/materials/${id}`,
  NEXT_CODE: "/api/v1/materials/next-code",
} as const;

export const MATERIAL_QUERY_KEYS = {
  list: (includeArchived: boolean) =>
    ["materials", { includeArchived }] as const,
  byId: (id: string) => ["material", id] as const,
  nextCode: ["material", "next-code"] as const,
} as const;

export const MATERIAL_MESSAGES = {
  CREATE_SUCCESS: "Táº¡o váº­t tÆ° thÃ nh cÃ´ng.",
  UPDATE_SUCCESS: "Cáº­p nháº­t váº­t tÆ° thÃ nh cÃ´ng.",
  DELETE_SUCCESS: "XoÃ¡ váº­t tÆ° thÃ nh cÃ´ng.",
  ARCHIVE_SUCCESS: "ÄÃ£ lÆ°u trá»¯ váº­t tÆ°.",
  UNARCHIVE_SUCCESS: "ÄÃ£ khÃ´i phá»¥c váº­t tÆ°.",
} as const;

// MasterData categories for materials
export const MATERIAL_MASTER_DATA_CATEGORIES = {
  UNIT: "don-vi-tinh",
  TYPE: "loai-vat-tu",
  DEPARTMENT: "bo-mon",
  CATEGORY: "nhom-vat-tu",
  SUB_CATEGORY: "phan-nhom-vat-tu",
  TAGS: "tag-vat-tu",
} as const;
```

---

## ğŸ—ï¸ Folder Structure

```
src/features/materials/
â”œâ”€â”€ index.ts                        # Barrel export
â”œâ”€â”€ constants.ts                    # Endpoints, query keys, messages
â”œâ”€â”€ api.ts                          # API client (GET only)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useMaterials.ts            # Query: List
â”‚   â”œâ”€â”€ useMaterialById.ts         # Query: By ID
â”‚   â”œâ”€â”€ useCreateMaterial.ts       # Mutation: Create
â”‚   â”œâ”€â”€ useUpdateMaterial.ts       # Mutation: Update
â”‚   â”œâ”€â”€ useDeleteMaterial.ts       # Mutation: Delete
â”‚   â”œâ”€â”€ useArchiveMaterial.ts      # Mutation: Archive
â”‚   â””â”€â”€ useUnarchiveMaterial.ts    # Mutation: Unarchive
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ MaterialTable.tsx          # Dumb component - Table
â”‚   â””â”€â”€ MaterialFormModal.tsx      # React Hook Form modal
â””â”€â”€ views/
    â””â”€â”€ MaterialsPageView.tsx      # Smart component - Main page

src/server/
â”œâ”€â”€ actions/
â”‚   â””â”€â”€ material.actions.ts         # Server Actions (5 actions)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ material.service.ts         # Business logic
â”‚   â””â”€â”€ material/_mappers.ts        # DTO mapping
â””â”€â”€ repos/
    â””â”€â”€ material.repo.ts             # Prisma queries

src/app/api/v1/materials/
â”œâ”€â”€ route.ts                         # GET list
â”œâ”€â”€ next-code/
â”‚   â””â”€â”€ route.ts                     # GET next code
â””â”€â”€ [id]/
    â””â”€â”€ route.ts                     # GET by ID

src/app/(private)/inventory/
â””â”€â”€ materials/
    â””â”€â”€ page.tsx                     # Route page
```

---

## ğŸ”’ Security & Permissions

- Admin: Create, Update, Delete, Archive, Unarchive (server-side guard `requireAdmin()`)
- Authenticated users: View list, View details (for dropdown selections in Goods Receipt/Issue)
- Measures: Session validation, server-side role checking, input sanitization, Prisma query safety

---

## ğŸš€ Performance & Optimization

- React Query cache: `staleTime` 60s cho list, 60s cho detail (master data cache strategy)
- Smart invalidation sau mutations
- Index gá»£i Ã½ (DB): `@@index([materialType, department, category])`, `@@index([archivedAt])`, `@@index([tags])`

---

## ğŸ§ª Test Cases

### TC-1: Auto-generate material code

- **Action**: Create new material
- **Expected**: Code auto-generated as MAT0001, MAT0002... (sequential)

### TC-2: Unique name validation

- **Input**: name Ä‘Ã£ tá»“n táº¡i
- **Expected**: Status 400, "TÃªn váº­t tÆ° Ä‘Ã£ tá»“n táº¡i"

### TC-3: Archive cascade check

- **Setup**: Material cÃ³ GoodsReceiptDetails
- **Action**: Hard delete
- **Expected**: Status 400, "Váº­t tÆ° Ä‘ang cÃ³ dá»¯ liá»‡u liÃªn káº¿t..."

### TC-4: Filter by type and department

- **Action**: Table filter by materialType + department
- **Expected**: Chá»‰ hiá»ƒn thá»‹ váº­t tÆ° thuá»™c type vÃ  department Ä‘Ã£ chá»n

### TC-5: Archive toggle

- **Action**: Toggle "Hiá»ƒn thá»‹ archived"
- **Expected**: Hiá»ƒn thá»‹/áº©n váº­t tÆ° cÃ³ archivedAt

### TC-6: Tags management

- **Action**: Select tags from MasterData (category='tag-vat-tu')
- **Expected**: Tags lÆ°u dáº¡ng array of keys (e.g., ['de-vo', 'cao-cap']) trong PostgreSQL

---

## ğŸ¯ Acceptance Criteria

### Testing Checklist

- [ ] Admin cÃ³ thá»ƒ táº¡o/sá»­a/xoÃ¡/archive/unarchive váº­t tÆ°
- [ ] User Ä‘Äƒng nháº­p cÃ³ thá»ƒ xem list vÃ  chi tiáº¿t (for Goods Receipt/Issue)
- [ ] **Employee khÃ´ng tháº¥y menu** "Váº­t tÆ°" trong sidebar
- [ ] Server-side permission check cho táº¥t cáº£ mutations vÃ  queries
- [ ] Validation hoáº¡t Ä‘á»™ng Ä‘Ãºng: name unique, code auto-generated
- [ ] MÃ n hÃ¬nh list vá»›i toggle "Hiá»ƒn thá»‹ archived"
- [ ] Table filter theo loáº¡i/bá»™ mÃ´n/nhÃ³m (frontend filter) vÃ  sorter (name, code) hoáº¡t Ä‘á»™ng
- [ ] Select fields láº¥y tá»« MasterData (Ä‘Æ¡n vá»‹ tÃ­nh, loáº¡i VT, bá»™ mÃ´n, nhÃ³m VT, phÃ¢n nhÃ³m VT)
- [ ] Archive/Unarchive: cáº­p nháº­t tráº¡ng thÃ¡i vÃ  pháº£n Ã¡nh trÃªn UI
- [ ] Delete: cháº·n khi cÃ³ dá»¯ liá»‡u liÃªn káº¿t; cho phÃ©p khi khÃ´ng cÃ³
- [ ] Modal responsive, loading/error/success states rÃµ rÃ ng
- [ ] Tags: Select mode="multiple" láº¥y tá»« MasterData (category='tag-vat-tu')

### Quality Standards

- TypeScript strict mode, Zod validation á»Ÿ client/server
- Error mapping thÃ¢n thiá»‡n, dÃ¹ng notify utils
- Accessibility cÆ¡ báº£n, hiá»‡u nÄƒng á»•n Ä‘á»‹nh
- Äá»“ng bá»™ pattern vá»›i Supplier vÃ  Dental Service (PageView + Table + Modal)

---

## ğŸ“¦ Seed Data

```typescript
// YÃªu cáº§u MasterData cÃ³ sáºµn:
// - category='don-vi-tinh': 'cai', 'hop', 'lo', 'chai', 'kg'
// - category='loai-vat-tu': 'tieu-hao', 'khong-tieu-hao', 'ccdc', 'tai-san'
// - category='bo-mon': 'noi-nha', 'phuc-hinh', 'implant', 'chinh-nha', 'chung'
// - category='nhom-vat-tu': 'implant', 'composite', 'amalgam'
// - category='phan-nhom-vat-tu': 'tru-implant', 'abutment', 'composite-nano'
// - category='tag-vat-tu': 'cao-cap', 'nhap-khau', 'de-vo', 'can-lanh', 'tieu-hao-nhanh'

const materials = [
  {
    code: "MAT0001", // Auto-generated
    name: "Implant Nobel Biocare Active 4.3x10mm",
    description: "Trá»¥ implant Nobel Biocare, Ä‘Æ°á»ng kÃ­nh 4.3mm, chiá»u dÃ i 10mm",
    unit: "cai", // Key tá»« MasterData (category='don-vi-tinh')
    materialType: "tieu-hao", // Key tá»« MasterData (category='loai-vat-tu')
    department: "implant", // Key tá»« MasterData (category='bo-mon')
    category: "implant", // Key tá»« MasterData (category='nhom-vat-tu')
    subCategory: "tru-implant", // Key tá»« MasterData (category='phan-nhom-vat-tu')
    minStockLevel: 10,
    tags: ["cao-cap", "nhap-khau"], // Keys tá»« MasterData (category='tag-vat-tu')
  },
  {
    code: "MAT0002",
    name: "GÄƒng tay Latex khÃ´ng bá»™t size M",
    description: "Há»™p 100 chiáº¿c, khÃ´ng bá»™t, khÃ´ng mÃ¹i",
    unit: "hop",
    materialType: "tieu-hao",
    department: "chung",
    category: null,
    subCategory: null,
    minStockLevel: 50,
    tags: ["tieu-hao-nhanh"], // Keys tá»« MasterData (category='tag-vat-tu')
  },
  {
    code: "MAT0003",
    name: "Composite 3M Filtek Z350 XT mÃ u A3",
    description: "Syringe 4g, composite nano hybrid",
    unit: "cai",
    materialType: "tieu-hao",
    department: "noi-nha",
    category: "composite",
    subCategory: "composite-nano",
    minStockLevel: 5,
    tags: ["cao-cap"], // Keys tá»« MasterData (category='tag-vat-tu')
  },
];
```

---

**Priority**: ğŸ”´ High  
**Estimated Effort**: 2-3 ngÃ y  
**Dependencies**: 015.1 Master Data (categories: 'don-vi-tinh', 'loai-vat-tu', 'bo-mon', 'nhom-vat-tu', 'phan-nhom-vat-tu', 'tag-vat-tu')  
**Pattern**: Supplier/Dental Service (PageView + Table + Modal)  
**Architecture**: UI Components â†’ Custom Hooks â†’ API Client â†’ Routes â†’ Services â†’ Repository â†’ Database
