# 016.2 Labo Service Prices - Báº£ng GiÃ¡ XÆ°á»Ÿng

## ğŸ“‹ Tá»•ng Quan

**Feature**: Quáº£n lÃ½ báº£ng giÃ¡ dá»‹ch vá»¥ labo cá»§a tá»«ng xÆ°á»Ÿng rÄƒng giáº£

**Má»¥c Ä‘Ã­ch**:

- Setup giÃ¡ vÃ  báº£o hÃ nh cho tá»«ng loáº¡i rÄƒng giáº£ cá»§a tá»«ng xÆ°á»Ÿng
- Cáº­p nháº­t giÃ¡ khi xÆ°á»Ÿng thay Ä‘á»•i báº£ng giÃ¡
- LÃ m reference cho LaboOrder (snapshot pricing)

**Route**: `/labo-services`

---

## ğŸ¯ User Stories

### US-1: Xem báº£ng giÃ¡ táº¥t cáº£ xÆ°á»Ÿng

**LÃ ** Admin/Manager  
**TÃ´i muá»‘n** xem báº£ng giÃ¡ cá»§a táº¥t cáº£ xÆ°á»Ÿng  
**Äá»ƒ** so sÃ¡nh giÃ¡ vÃ  quáº£n lÃ½

**Acceptance Criteria**:

- [ ] Table vá»›i columns: XÆ°á»Ÿng, TÃªn dá»‹ch vá»¥, NhÃ³m DV, ÄÆ¡n vá»‹, GiÃ¡, Báº£o hÃ nh, Actions
- [ ] Search theo tÃªn xÆ°á»Ÿng hoáº·c tÃªn dá»‹ch vá»¥ (real-time, filter á»Ÿ frontend)
- [ ] Load táº¥t cáº£ dá»¯ liá»‡u (khÃ´ng phÃ¢n trang)
- [ ] Sort theo giÃ¡ (tháº¥p â†’ cao, cao â†’ tháº¥p)

### US-2: ThÃªm dá»‹ch vá»¥ cho xÆ°á»Ÿng

**LÃ ** Admin  
**TÃ´i muá»‘n** thÃªm dá»‹ch vá»¥ má»›i vÃ o báº£ng giÃ¡ xÆ°á»Ÿng  
**Äá»ƒ** cáº­p nháº­t khi xÆ°á»Ÿng cÃ³ sáº£n pháº©m má»›i

**Acceptance Criteria**:

- [ ] Button "ThÃªm dá»‹ch vá»¥" má»Ÿ modal
- [ ] Form: XÆ°á»Ÿng (_), Loáº¡i rÄƒng giáº£ (_), GiÃ¡ (_), Báº£o hÃ nh (_)
- [ ] XÆ°á»Ÿng: Dropdown chá»‰ hiá»ƒn thá»‹ suppliers type = "labo-xuong-rang-gia"
- [ ] Loáº¡i rÄƒng giáº£: Dropdown tá»« LaboItem (active only)
- [ ] GiÃ¡: Number input, format VND
- [ ] Báº£o hÃ nh: Dropdown tá»« `bao-hanh-labo`
- [ ] Validation: Unique (supplierId + laboItemId)
- [ ] Success: Refresh table, toast success

### US-3: Cáº­p nháº­t giÃ¡/báº£o hÃ nh

**LÃ ** Admin  
**TÃ´i muá»‘n** cáº­p nháº­t giÃ¡ hoáº·c báº£o hÃ nh khi xÆ°á»Ÿng thay Ä‘á»•i  
**Äá»ƒ** dá»¯ liá»‡u luÃ´n chÃ­nh xÃ¡c

**Acceptance Criteria**:

- [ ] Click Edit â†’ Modal vá»›i data hiá»‡n táº¡i
- [ ] Cho phÃ©p sá»­a: GiÃ¡, Báº£o hÃ nh (KHÃ”NG sá»­a xÆ°á»Ÿng/loáº¡i rÄƒng)
- [ ] Update trá»±c tiáº¿p (khÃ´ng version history)
- [ ] LaboOrder cÅ© giá»¯ nguyÃªn giÃ¡ cÅ© (Ä‘Ã£ snapshot)
- [ ] Success: Update table, toast

### US-4: XÃ³a dá»‹ch vá»¥

**LÃ ** Admin  
**TÃ´i muá»‘n** xÃ³a dá»‹ch vá»¥ khÃ´ng cÃ²n cung cáº¥p  
**Äá»ƒ** dá»n dáº¹p báº£ng giÃ¡

**Acceptance Criteria**:

- [ ] Button Delete vá»›i confirmation
- [ ] Chá»‰ xÃ³a náº¿u: ChÆ°a cÃ³ LaboOrder nÃ o sá»­ dá»¥ng
- [ ] Náº¿u Ä‘Ã£ dÃ¹ng: Error "KhÃ´ng thá»ƒ xÃ³a. Dá»‹ch vá»¥ nÃ y Ä‘Ã£ cÃ³ Ä‘Æ¡n hÃ ng."
- [ ] Success: XÃ³a khá»i DB, refresh table

### US-5: Import/Export Excel

**LÃ ** Admin  
**TÃ´i muá»‘n** import/export báº£ng giÃ¡ Excel  
**Äá»ƒ** cáº­p nháº­t hÃ ng loáº¡t hoáº·c backup

**Acceptance Criteria** (Future):

- [ ] Export: Xuáº¥t toÃ n bá»™ báº£ng giÃ¡ ra Excel
- [ ] Import: Upload Excel theo template Ä‘á»ƒ cáº­p nháº­t giÃ¡ hÃ ng loáº¡t
- [ ] Validation: Check duplicate, giÃ¡ há»£p lá»‡
- [ ] Preview trÆ°á»›c khi import

---

## ğŸ¨ UI Design

### Table View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Báº£ng GiÃ¡ Dá»‹ch Vá»¥ Labo            [ğŸ” TÃ¬m kiáº¿m...] [+ ThÃªm dá»‹ch vá»¥]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ XÆ°á»Ÿng        â”‚ TÃªn dá»‹ch vá»¥       â”‚ NhÃ³m DV    â”‚ GiÃ¡         â”‚ BH  â”‚ Act â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Anh Nam Labo â”‚ RÄƒng sá»© kim loáº¡i  â”‚ RÄƒng sá»© KL â”‚ 300.000 â‚«  â”‚ 1 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â”‚ Anh Nam Labo â”‚ RÄƒng sá»© titan     â”‚ RÄƒng sá»© KL â”‚ 400.000 â‚«  â”‚ 1 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â”‚ Anh Nam Labo â”‚ RÄƒng sá»© Zirconia  â”‚ RÄƒng toÃ n sá»©â”‚700.000 â‚«  â”‚ 5 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â”‚ Anh Nam Labo â”‚ RÄƒng sá»© Katana    â”‚ RÄƒng toÃ n sá»©â”‚700.000 â‚«  â”‚ 5 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â”‚ Tung Dentalabâ”‚ RÄƒng sá»© HT Smile  â”‚ RÄƒng toÃ n sá»©â”‚1.100.000 â‚«â”‚10 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â”‚ Giang Lab    â”‚ HÃ m duy trÃ¬ Hawleyâ”‚ Chá»‰nh nha  â”‚ 170.000 â‚«  â”‚ 1 nÄƒmâ”‚[âœï¸][ğŸ—‘ï¸]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Hiá»ƒn thá»‹ 25 items                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Create Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [X] ThÃªm Dá»‹ch Vá»¥ Labo                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚ XÆ°á»Ÿng labo *                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Anh Nam Labo              â–¼        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   (Chá»‰ hiá»ƒn thá»‹ xÆ°á»Ÿng rÄƒng giáº£)         â”‚
â”‚                                           â”‚
â”‚ Loáº¡i rÄƒng giáº£ *                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ RÄƒng sá»© Zirconia          â–¼        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   NhÃ³m: RÄƒng toÃ n sá»© | ÄÆ¡n vá»‹: RÄƒng     â”‚
â”‚                                           â”‚
â”‚ GiÃ¡ (VND) *                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 700,000                             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚
â”‚ Báº£o hÃ nh *                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 5 nÄƒm                     â–¼        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   (Dropdown tá»« MasterData: bao-hanh-labo)â”‚
â”‚   LÆ°u key string: "5-nam"               â”‚
â”‚   Options: 6 thÃ¡ng, 1 nÄƒm, 2 nÄƒm,       â”‚
â”‚            5 nÄƒm, 7 nÄƒm, 10 nÄƒm          â”‚
â”‚                                           â”‚
â”‚          [Há»§y]  [LÆ°u]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [X] Cáº­p Nháº­t GiÃ¡ Dá»‹ch Vá»¥                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚ XÆ°á»Ÿng: Anh Nam Labo                     â”‚
â”‚ Dá»‹ch vá»¥: RÄƒng sá»© Zirconia               â”‚
â”‚ NhÃ³m: RÄƒng toÃ n sá»© | ÄÆ¡n vá»‹: RÄƒng       â”‚
â”‚                                           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                           â”‚
â”‚ GiÃ¡ (VND) *                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 750,000          (CÅ©: 700,000)     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚
â”‚ Báº£o hÃ nh *                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 7 nÄƒm                     â–¼        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   (Hiá»‡n táº¡i: 5 nÄƒm)                      â”‚
â”‚                                           â”‚
â”‚ âš ï¸ LÆ°u Ã½: GiÃ¡ cÅ© trong cÃ¡c Ä‘Æ¡n hÃ ng     â”‚
â”‚   trÆ°á»›c Ä‘Ã³ sáº½ khÃ´ng thay Ä‘á»•i            â”‚
â”‚                                           â”‚
â”‚          [Há»§y]  [Cáº­p nháº­t]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Schema

### Prisma Model

```prisma
model SupplierLaboPrice {
  id         String   @id @default(uuid())

  // References
  supplierId String
  laboItemId String

  // Pricing
  price    Decimal  @db.Decimal(10, 0)
  warranty String   // "5-nam" (string value, not FK)

  // Metadata
  createdById String
  updatedById String
  createdAt   DateTime @default(now()) @db.Timestamptz
  updatedAt   DateTime @updatedAt @db.Timestamptz

  // Relations
  supplier    Supplier  @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  laboItem    LaboItem  @relation(fields: [laboItemId], references: [id], onDelete: Restrict)
  createdBy   Employee   @relation("SupplierLaboPriceCreatedBy", fields: [createdById], references: [id])
  updatedBy   Employee   @relation("SupplierLaboPriceUpdatedBy", fields: [updatedById], references: [id])

  @@unique([supplierId, laboItemId])
  @@index([supplierId])
  @@index([laboItemId])
}
```

### Response Type

```typescript
SupplierLaboPriceResponse {
  id: string

  supplier: {
    id: string
    name: string
  }

  laboItem: {
    id: string
    name: string
    serviceGroup: string         // "rang-toan-su"
    serviceGroupLabel: string    // "RÄƒng toÃ n sá»©" (lookup from constants)
    unit: string                 // "rang"
    unitLabel: string            // "RÄƒng" (lookup from constants)
  }

  price: number

  warranty: string               // "5-nam"
  warrantyLabel: string          // "5 nÄƒm" (lookup from constants)  createdAt: string
  updatedAt: string
}
```

---

## ğŸ”„ API Specification

### Endpoints

#### GET `/api/v1/labo-services`

**Query**:

```typescript
{
  sortBy?: 'price' | 'name'
  sortOrder?: 'asc' | 'desc'
}
```

**Response**:

```typescript
{
  items: SupplierLaboPriceResponse[]
}
```

**Note**: Load táº¥t cáº£ dá»¯ liá»‡u, search vÃ  filter thá»±c hiá»‡n á»Ÿ frontend

#### GET `/api/v1/labo-services/:id`

**Response**: `SupplierLaboPriceResponse`

#### POST `/api/v1/labo-services`

**Body**:

```typescript
{
  supplierId: string;
  laboItemId: string;
  price: number; // Decimal, VND
  warranty: string; // "5-nam"
}
```

#### PUT `/api/v1/labo-services/:id`

**Body**:

```typescript
{
  price: number; // Chá»‰ update giÃ¡
  warranty: string; // Chá»‰ update báº£o hÃ nh ("5-nam")
}
```

**Note**: KhÃ´ng cho update `supplierId` vÃ  `laboItemId` (xÃ³a vÃ  táº¡o má»›i thay tháº¿)

#### DELETE `/api/v1/labo-services/:id`

**Business Rule**: Chá»‰ xÃ³a náº¿u khÃ´ng cÃ³ LaboOrder nÃ o reference

---

## ğŸ” Permissions

### View

```typescript
"labo-services:view";
```

- Roles: admin only

### Create

```typescript
"labo-services:create";
```

- Roles: admin only

### Update

```typescript
"labo-services:update";
```

- Roles: admin only

### Delete

```typescript
"labo-services:delete";
```

- Roles: admin only

---

## ğŸ” Validation Rules

### Create

```typescript
CreateSupplierLaboPriceSchema = z.object({
  supplierId: z.string().min(1, "Vui lÃ²ng chá»n xÆ°á»Ÿng"),

  laboItemId: z.string().min(1, "Vui lÃ²ng chá»n loáº¡i rÄƒng giáº£"),

  price: z
    .number()
    .positive("GiÃ¡ pháº£i lá»›n hÆ¡n 0")
    .max(100_000_000, "GiÃ¡ khÃ´ng há»£p lÃ½"),

  warrantyId: z.string().min(1, "Vui lÃ²ng chá»n báº£o hÃ nh"),
});
```

### Update

```typescript
UpdateSupplierLaboPriceSchema = z.object({
  price: z
    .number()
    .positive("GiÃ¡ pháº£i lá»›n hÆ¡n 0")
    .max(100_000_000, "GiÃ¡ khÃ´ng há»£p lÃ½"),

  warrantyId: z.string().min(1, "Vui lÃ²ng chá»n báº£o hÃ nh"),
});
```

### Business Rules

1. **Unique pair**: (supplierId, laboItemId) pháº£i unique
2. **Valid supplier**: supplierId pháº£i lÃ  supplier type = "labo-xuong-rang-gia"
3. **Active LaboItem**: laboItemId pháº£i lÃ  LaboItem chÆ°a bá»‹ archive
4. **Valid warranty**: warranty pháº£i lÃ  má»™t trong: 6-thang, 1-nam, 2-nam, 5-nam, 7-nam, 10-nam
5. **Cannot delete if used**: KhÃ´ng xÃ³a náº¿u cÃ³ LaboOrder reference
6. **Update pricing**: Cáº­p nháº­t giÃ¡ khÃ´ng áº£nh hÆ°á»Ÿng orders cÅ© (Ä‘Ã£ snapshot)

---

## ğŸ§ª Test Cases

### TC-1: Create Success

```
Given: User cÃ³ quyá»n, supplier vÃ  laboItem há»£p lá»‡
When: Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin há»£p lá»‡
Then:
  - SupplierLaboPrice Ä‘Æ°á»£c táº¡o
  - Toast success
  - Table refresh
```

### TC-2: Create - Duplicate

```
Given: ÄÃ£ tá»“n táº¡i (Anh Nam Labo, RÄƒng sá»© Katana)
When: Táº¡o láº¡i cáº·p nÃ y
Then: Error "Dá»‹ch vá»¥ nÃ y Ä‘Ã£ cÃ³ trong báº£ng giÃ¡ xÆ°á»Ÿng"
```

### TC-3: Update Price

```
Given: SupplierLaboPrice cÃ³ giÃ¡ 700,000
When: Update giÃ¡ thÃ nh 750,000
Then:
  - GiÃ¡ Ä‘Æ°á»£c cáº­p nháº­t
  - LaboOrder cÅ© váº«n giá»¯ 700,000 (snapshot)
  - LaboOrder má»›i sáº½ láº¥y 750,000
```

### TC-4: Delete - Cannot Delete

```
Given: SupplierLaboPrice Ä‘Ã£ cÃ³ LaboOrder reference
When: Click Delete
Then: Error "KhÃ´ng thá»ƒ xÃ³a. Dá»‹ch vá»¥ nÃ y Ä‘Ã£ cÃ³ Ä‘Æ¡n hÃ ng."
```

### TC-5: Search by Supplier (Frontend)

```
Given: CÃ³ 25 items Ä‘Ã£ load tá»« 3 xÆ°á»Ÿng: Anh Nam, Tung, Giang
When: Nháº­p "Anh Nam" vÃ o search box
Then:
  - Filter frontend chá»‰ hiá»ƒn thá»‹ prices cá»§a Anh Nam Labo
  - KhÃ´ng gá»i API
  - Cáº­p nháº­t sá»‘ lÆ°á»£ng hiá»ƒn thá»‹
```

### TC-6: Sort by Price (Frontend)

```
Given: 25 prices Ä‘Ã£ load, tá»« 170k Ä‘áº¿n 1.2M
When: Click sort by price ASC
Then:
  - Frontend sort hiá»ƒn thá»‹ tá»« giÃ¡ tháº¥p Ä‘áº¿n cao
  - KhÃ´ng gá»i API
```

---

## ğŸ’¡ Business Logic

### Snapshot Pricing Strategy

**Táº¡i sao snapshot?**

- XÆ°á»Ÿng thay Ä‘á»•i giÃ¡ theo thá»i gian
- LaboOrder cáº§n lÆ°u giÃ¡ táº¡i thá»i Ä‘iá»ƒm táº¡o
- BÃ¡o cÃ¡o chÃ­nh xÃ¡c chi phÃ­ Ä‘Ã£ phÃ¡t sinh

**How it works:**

```typescript
// Khi táº¡o LaboOrder
const supplierPrice = await getSupplierLaboPrice(supplierId, laboItemId);

const order = await createLaboOrder({
  ...data,
  unitPrice: supplierPrice.price, // Snapshot
  warranty: supplierPrice.warranty, // Snapshot: "5-nam"
  warrantyLabel: getWarrantyLabel(supplierPrice.warranty), // Snapshot: "5 nÄƒm"
  totalCost: supplierPrice.price * quantity,
});
```

**Result:**

- Update SupplierLaboPrice â†’ khÃ´ng áº£nh hÆ°á»Ÿng orders cÅ©
- Má»—i order giá»¯ giÃ¡ táº¡i thá»i Ä‘iá»ƒm Ä‘áº·t hÃ ng
- BÃ¡o cÃ¡o chÃ­nh xÃ¡c theo thá»i gian

---

## ğŸ“Š Related Queries

### Get Active Prices for Dropdown (LaboOrder create)

```typescript
// Khi táº¡o LaboOrder, chá»n xÆ°á»Ÿng â†’ load prices
GET /api/v1/labo-services?supplierId={id}&includeInactive=false

// Response: List LaboItem vá»›i giÃ¡ cá»§a xÆ°á»Ÿng Ä‘Ã³
[
  { laboItemId, laboItemName, price, warranty },
  ...
]
```

---

## ğŸ“‹ Implementation Checklist

### Backend

- [ ] Prisma model: SupplierLaboPrice
- [ ] Migration: Add table + indexes
- [ ] Repository: `supplier-labo-price.repo.ts`
- [ ] Service: `supplier-labo-price.service.ts`
- [ ] Server Actions: `supplier-labo-price.actions.ts`
- [ ] API Routes: `/api/v1/labo-services/*`
- [ ] Validation: Zod schemas

### Frontend

- [ ] API client: `api.ts`
- [ ] React Query hooks: `useLaboServices`, `useCreateLaboService`...
- [ ] Components:
  - [ ] `LaboServiceTable.tsx`
  - [ ] `LaboServiceModal.tsx` (Create + Edit)
- [ ] View: `LaboServicesView.tsx`
- [ ] Constants: `labo-services/constants.ts`

### Integration

- [ ] Update Supplier model: Add relation
- [ ] Update LaboItem model: Add relation
- [ ] Seed warranty master data

---

## ğŸ”— Related Features

- **016.1 Labo Item Master**: Reference LaboItem
- **015.2 Supplier Management**: Reference Supplier (type = labo)
- **016.3 Labo Orders - Daily View**: Get price snapshot khi táº¡o order
- **016.4 Labo Reports**: Cost analysis dá»±a trÃªn pricing

---

**Version**: 1.0  
**Last Updated**: 2025-12-03  
**Status**: Ready for Implementation
