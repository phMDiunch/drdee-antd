# ğŸ¢ Requirements: Supplier Management (Quáº£n LÃ½ NhÃ  Cung Cáº¥p)

> **ğŸ“‹ STATUS: PENDING** - Giai Ä‘oáº¡n 1, TÃ­nh nÄƒng 2  
> **ğŸ”— Parent**: `015 Inventory - Overview.md`  
> **ğŸ“„ Implementation**: `src/features/inventory/suppliers/`  
> **âš ï¸ Dependencies**: `015.1 System Dictionary.md` (cáº§n cÃ³ sáºµn SUPPLIER_GROUP)

## ğŸ¯ Má»¥c TiÃªu

Quáº£n lÃ½ thÃ´ng tin cÃ¡c Ä‘Æ¡n vá»‹ cung cáº¥p hÃ ng hÃ³a/váº­t tÆ° cho phÃ²ng khÃ¡m. ThÃ´ng tin nÃ y sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng khi:

- Táº¡o Phiáº¿u nháº­p kho
- Quáº£n lÃ½ cÃ´ng ná»£ (Giai Ä‘oáº¡n 2)
- BÃ¡o cÃ¡o hiá»‡u suáº¥t nhÃ  cung cáº¥p (Giai Ä‘oáº¡n 4)

## ğŸ“‹ User Stories

### US-1: Xem Danh SÃ¡ch NCC

**LÃ  User**, tÃ´i muá»‘n:

- Xem danh sÃ¡ch táº¥t cáº£ nhÃ  cung cáº¥p vá»›i phÃ¢n trang
- Lá»c theo nhÃ³m nhÃ  cung cáº¥p
- Lá»c theo tráº¡ng thÃ¡i (Äang hoáº¡t Ä‘á»™ng / Ngá»«ng giao dá»‹ch)
- TÃ¬m kiáº¿m theo tÃªn, mÃ£, tÃªn viáº¿t táº¯t

### US-2: Táº¡o Má»›i NCC

**LÃ  User**, tÃ´i muá»‘n:

- Táº¡o má»›i nhÃ  cung cáº¥p
- Há»‡ thá»‘ng tá»± Ä‘á»™ng sinh mÃ£ NCC (VD: SUP0001, SUP0002...)
- Chá»n nhÃ³m NCC tá»« danh sÃ¡ch Ä‘Ã£ cáº¥u hÃ¬nh
- Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin liÃªn há»‡

### US-3: Cáº­p Nháº­t ThÃ´ng Tin

**LÃ  User**, tÃ´i muá»‘n:

- Chá»‰nh sá»­a thÃ´ng tin NCC
- Thay Ä‘á»•i tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng
- KhÃ´ng cho phÃ©p sá»­a mÃ£ NCC (Ä‘Ã£ tá»± sinh)

### US-4: VÃ´ Hiá»‡u HÃ³a NCC

**LÃ  User**, tÃ´i muá»‘n:

- ÄÃ¡nh dáº¥u NCC ngá»«ng há»£p tÃ¡c (set isActive = false)
- KhÃ´ng xÃ³a cá»©ng Ä‘á»ƒ giá»¯ lá»‹ch sá»­ giao dá»‹ch

## ğŸ¨ UI/UX Requirements

### MÃ n hÃ¬nh Danh sÃ¡ch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¢ Quáº£n LÃ½ NhÃ  Cung Cáº¥p                           [+ ThÃªm NCC Má»›i]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NhÃ³m NCC: [Táº¥t cáº£ â–¼]  Tráº¡ng thÃ¡i: [Táº¥t cáº£ â–¼]  ğŸ” [TÃ¬m kiáº¿m...]    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MÃ£ NCC  â”‚ TÃªn            â”‚ TÃªn VT â”‚ NhÃ³m      â”‚ SÄT      â”‚ âš™  â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”‚  â”‚
â”‚  â”‚ SUP0001 â”‚ CÃ´ng ty ABC    â”‚ ABC    â”‚ VT Y Táº¿   â”‚ 090...   â”‚ âœ â”‚  â”‚
â”‚  â”‚ SUP0002 â”‚ Labo XYZ       â”‚ XYZ    â”‚ Labo      â”‚ 091...   â”‚ âœ â”‚  â”‚
â”‚  â”‚ SUP0003 â”‚ Váº­t tÆ° Minh... â”‚ VM     â”‚ VÄƒn phÃ²ng â”‚ 092...   â”‚ âœ â”‚  â”‚
â”‚  â”‚ SUP0004 â”‚ ğŸš« NCC DEF (Ngâ”‚ DEF    â”‚ VT Y Táº¿   â”‚ 093...   â”‚ âœ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      [â—€] Trang 1 / 5 [â–¶]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Drawer/Modal ThÃªm/Sá»­a NCC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœï¸  ThÃªm NhÃ  Cung Cáº¥p                    [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  MÃ£ NCC                                           â”‚
â”‚  [ SUP0005 ]  (Tá»± Ä‘á»™ng sinh)                      â”‚
â”‚                                                   â”‚
â”‚  TÃªn nhÃ  cung cáº¥p *                               â”‚
â”‚  [_____________________________]                  â”‚
â”‚                                                   â”‚
â”‚  TÃªn viáº¿t táº¯t (Short Name)                        â”‚
â”‚  [___________]                                    â”‚
â”‚                                                   â”‚
â”‚  NhÃ³m nhÃ  cung cáº¥p *                              â”‚
â”‚  [Dropdown: Chá»n nhÃ³m â–¼]                          â”‚
â”‚    - Váº­t tÆ° thiáº¿t bá»‹ y táº¿                         â”‚
â”‚    - Labo - XÆ°á»Ÿng rÄƒng giáº£                        â”‚
â”‚    - Váº­t tÆ° vÄƒn phÃ²ng                             â”‚
â”‚                                                   â”‚
â”‚  Sá»‘ Ä‘iá»‡n thoáº¡i                                    â”‚
â”‚  [___________]                                    â”‚
â”‚                                                   â”‚
â”‚  Email                                            â”‚
â”‚  [___________]                                    â”‚
â”‚                                                   â”‚
â”‚  Äá»‹a chá»‰                                          â”‚
â”‚  [_____________________________]                  â”‚
â”‚                                                   â”‚
â”‚  MÃ£ sá»‘ thuáº¿                                       â”‚
â”‚  [___________]                                    â”‚
â”‚                                                   â”‚
â”‚  Ghi chÃº                                          â”‚
â”‚  [_____________________________]                  â”‚
â”‚  [_____________________________]                  â”‚
â”‚                                                   â”‚
â”‚  â˜‘ Äang hoáº¡t Ä‘á»™ng                                 â”‚
â”‚                                                   â”‚
â”‚         [Há»§y]               [LÆ°u]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Functional Requirements

### FR-1: Tá»± Äá»™ng Sinh MÃ£ NCC

**Logic**:

1. Prefix cá»‘ Ä‘á»‹nh: `SUP`
2. Padding 4 chá»¯ sá»‘: `0001`, `0002`...
3. Query mÃ£ cuá»‘i cÃ¹ng trong DB (vÃ­ dá»¥: `SUP0042`)
4. Parse sá»‘, tÄƒng lÃªn 1 â†’ `SUP0043`

**Code Example**:

```typescript
async function generateSupplierCode(): Promise<string> {
  const lastSupplier = await prisma.supplier.findFirst({
    where: { code: { startsWith: "SUP" } },
    orderBy: { code: "desc" },
  });

  if (!lastSupplier) return "SUP0001";

  const lastNumber = parseInt(lastSupplier.code.replace("SUP", ""));
  const nextNumber = lastNumber + 1;
  return `SUP${nextNumber.toString().padStart(4, "0")}`;
}
```

### FR-2: Business Rules

1. **MÃ£ NCC**: Tá»± Ä‘á»™ng sinh, khÃ´ng cho edit sau khi táº¡o
2. **TÃªn NCC**: Báº¯t buá»™c, tá»‘i thiá»ƒu 2 kÃ½ tá»±
3. **NhÃ³m NCC**: Báº¯t buá»™c, láº¥y tá»« SystemDictionary (type=SUPPLIER_GROUP)
4. **Soft Delete**: Set `isActive = false` thay vÃ¬ xÃ³a
5. **Unique**: TÃªn NCC nÃªn unique (cÃ³ thá»ƒ warning thay vÃ¬ block)

### FR-3: API Endpoints

```
GET    /api/inventory/suppliers?page=1&limit=20&search=&groupId=&isActive=  # List with filters
GET    /api/inventory/suppliers/:id                                         # Get by ID
POST   /api/inventory/suppliers                                             # Create (auto-gen code)
PUT    /api/inventory/suppliers/:id                                         # Update
DELETE /api/inventory/suppliers/:id                                         # Soft delete
GET    /api/inventory/suppliers/generate-code                               # Get next code
```

### FR-4: Search & Filter

**Search**: TÃ¬m kiáº¿m trong cÃ¡c trÆ°á»ng:

- `name` (ILIKE)
- `code` (ILIKE)
- `shortName` (ILIKE)

**Filter**:

- `supplierGroupId`: Lá»c theo nhÃ³m
- `isActive`: true/false/undefined (all)

## ğŸ’¾ Data Model (Prisma)

```prisma
model Supplier {
  id              Int      @id @default(autoincrement())
  code            String   @unique // SUP0001, SUP0002... (Tá»± sinh)
  name            String   // TÃªn Ä‘áº§y Ä‘á»§
  shortName       String?  // TÃªn viáº¿t táº¯t

  // Foreign key tá»›i SystemDictionary
  supplierGroupId Int
  supplierGroup   SystemDictionary @relation("SupplierGroup", fields: [supplierGroupId], references: [id])

  // Contact info
  phone           String?
  email           String?
  address         String?
  taxCode         String?  // MÃ£ sá»‘ thuáº¿

  // Metadata
  note            String?
  isActive        Boolean  @default(true)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations (sáº½ bá»• sung á»Ÿ cÃ¡c giai Ä‘oáº¡n sau)
  goodsReceipts   GoodsReceipt[] // CÃ¡c phiáº¿u nháº­p tá»« NCC nÃ y
  // accountsPayable AccountsPayable[] // CÃ´ng ná»£ (Phase 2)

  @@index([code])
  @@index([name])
  @@index([supplierGroupId, isActive])
}
```

## âœ… Validation (Zod Schema)

```typescript
import { z } from "zod";

export const supplierSchema = z.object({
  name: z
    .string()
    .min(2, "TÃªn nhÃ  cung cáº¥p pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±")
    .max(200, "TÃªn khÃ´ng Ä‘Æ°á»£c quÃ¡ 200 kÃ½ tá»±"),

  shortName: z
    .string()
    .max(50, "TÃªn viáº¿t táº¯t khÃ´ng Ä‘Æ°á»£c quÃ¡ 50 kÃ½ tá»±")
    .optional()
    .or(z.literal("")),

  supplierGroupId: z
    .number({
      required_error: "Vui lÃ²ng chá»n nhÃ³m nhÃ  cung cáº¥p",
    })
    .int()
    .positive(),

  phone: z
    .string()
    .regex(/^[0-9+\-\s()]*$/, "Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡")
    .max(20)
    .optional()
    .or(z.literal("")),

  email: z.string().email("Email khÃ´ng há»£p lá»‡").optional().or(z.literal("")),

  address: z.string().max(500, "Äá»‹a chá»‰ khÃ´ng Ä‘Æ°á»£c quÃ¡ 500 kÃ½ tá»±").optional(),

  taxCode: z
    .string()
    .max(20, "MÃ£ sá»‘ thuáº¿ khÃ´ng Ä‘Æ°á»£c quÃ¡ 20 kÃ½ tá»±")
    .optional()
    .or(z.literal("")),

  note: z.string().max(1000).optional(),

  isActive: z.boolean().default(true),
});

// Schema cho update (khÃ´ng bao gá»“m code vÃ¬ khÃ´ng cho sá»­a)
export const updateSupplierSchema = supplierSchema.partial();
```

## ğŸ§ª Test Cases

### TC-1: Táº¡o NCC thÃ nh cÃ´ng

- **Input**: Valid data, táº¥t cáº£ required fields
- **Expected**: Status 201, tráº£ vá» supplier vá»›i code tá»± sinh

### TC-2: Tá»± Ä‘á»™ng sinh mÃ£ tÄƒng dáº§n

- **Setup**: DB cÃ³ SUP0005
- **Action**: Táº¡o NCC má»›i
- **Expected**: code = SUP0006

### TC-3: Validate required fields

- **Input**: Thiáº¿u name hoáº·c supplierGroupId
- **Expected**: Status 400, error messages cá»¥ thá»ƒ

### TC-4: Validate email format

- **Input**: email = "invalid-email"
- **Expected**: Status 400, "Email khÃ´ng há»£p lá»‡"

### TC-5: Search hoáº¡t Ä‘á»™ng

- **Input**: GET /api/suppliers?search=abc
- **Expected**: Tráº£ vá» suppliers cÃ³ name/code/shortName chá»©a "abc" (case-insensitive)

### TC-6: Filter theo nhÃ³m

- **Input**: GET /api/suppliers?groupId=1
- **Expected**: Chá»‰ tráº£ vá» suppliers thuá»™c group 1

### TC-7: Soft delete

- **Action**: DELETE /api/suppliers/5
- **Expected**: isActive = false, record váº«n tá»“n táº¡i

### TC-8: KhÃ´ng cho sá»­a code

- **Action**: PUT /api/suppliers/5 vá»›i code má»›i
- **Expected**: Code khÃ´ng thay Ä‘á»•i hoáº·c bá»‹ ignore

## ğŸ¯ Acceptance Criteria

- [ ] Hiá»ƒn thá»‹ danh sÃ¡ch NCC vá»›i phÃ¢n trang
- [ ] Search theo tÃªn/mÃ£/tÃªn viáº¿t táº¯t hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c
- [ ] Filter theo nhÃ³m vÃ  tráº¡ng thÃ¡i
- [ ] Modal táº¡o má»›i hiá»ƒn thá»‹ code tá»± sinh (read-only)
- [ ] Dropdown "NhÃ³m NCC" láº¥y data tá»« SystemDictionary (type=SUPPLIER_GROUP)
- [ ] Validate Ä‘áº§y Ä‘á»§ cÃ¡c trÆ°á»ng theo Zod schema
- [ ] API tá»± sinh mÃ£ tÄƒng dáº§n khÃ´ng bá»‹ trÃ¹ng
- [ ] Soft delete khÃ´ng lÃ m máº¥t dá»¯ liá»‡u
- [ ] NCC khÃ´ng active khÃ´ng hiá»ƒn thá»‹ trong dropdown (á»Ÿ mÃ n hÃ¬nh khÃ¡c)

## ğŸ“¦ Dá»¯ Liá»‡u Máº«u (Seed Data)

```typescript
const suppliers = [
  {
    code: 'SUP0001',
    name: 'CÃ´ng ty TNHH Váº­t TÆ° Y Táº¿ ABC',
    shortName: 'ABC Medical',
    supplierGroupId: <vt-yte-group-id>,
    phone: '0901234567',
    email: 'contact@abc-medical.com',
    address: '123 Nguyá»…n VÄƒn A, Q1, HCM',
    taxCode: '0123456789',
    isActive: true
  },
  {
    code: 'SUP0002',
    name: 'Labo RÄƒng Sá»© XYZ',
    shortName: 'XYZ Labo',
    supplierGroupId: <labo-group-id>,
    phone: '0909876543',
    email: 'info@xyzlabo.vn',
    address: '456 LÃª VÄƒn B, Q3, HCM',
    isActive: true
  },
  {
    code: 'SUP0003',
    name: 'Váº­t TÆ° VÄƒn PhÃ²ng Minh Khang',
    shortName: 'MK Office',
    supplierGroupId: <van-phong-group-id>,
    phone: '0912345678',
    address: '789 Tráº§n VÄƒn C, Thá»§ Äá»©c, HCM',
    isActive: true
  }
];
```

## ğŸ”„ Integration Points

### Sá»­ dá»¥ng bá»Ÿi:

- **Phiáº¿u Nháº­p Kho** (015.4): Chá»n NCC khi táº¡o phiáº¿u nháº­p
- **Quáº£n LÃ½ CÃ´ng Ná»£** (015.7): Theo dÃµi cÃ´ng ná»£ vá»›i tá»«ng NCC
- **BÃ¡o CÃ¡o** (Giai Ä‘oáº¡n 4): PhÃ¢n tÃ­ch hiá»‡u suáº¥t NCC

### Phá»¥ thuá»™c vÃ o:

- **System Dictionary** (015.1): Láº¥y danh sÃ¡ch nhÃ³m NCC

---

**Priority**: ğŸ”´ High  
**Estimated Effort**: 1-2 ngÃ y  
**Dependencies**: 015.1 System Dictionary (SUPPLIER_GROUP pháº£i cÃ³ trÆ°á»›c)
