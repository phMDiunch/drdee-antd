# ‚ö†Ô∏è Requirements: Alert System - H·ªá Th·ªëng C·∫£nh B√°o Kho

> **üìã STATUS: PENDING** - Giai ƒëo·∫°n 1, T√≠nh nƒÉng 7 (An to√†n v·∫≠n h√†nh)  
> **üîó Parent**: `015 Inventory - Overview.md`  
> **üìÑ Implementation**: `src/features/inventory/alerts/`  
> **‚ö†Ô∏è Dependencies**: 015.4 GRN, 015.3 Material (c·∫ßn minStockLevel)

## üéØ M·ª•c Ti√™u

Cung c·∫•p h·ªá th·ªëng c·∫£nh b√°o t·ª± ƒë·ªông ƒë·ªÉ ph√°t hi·ªán s·ªõm c√°c r·ªßi ro trong kho:

- **R·ªßi ro ch·∫•t l∆∞·ª£ng**: H√†ng ƒë√£ h·∫øt h·∫°n ho·∫∑c s·∫Øp h·∫øt h·∫°n (< 6 th√°ng)
- **R·ªßi ro v·∫≠n h√†nh**: H√†ng s·∫Øp h·∫øt, kh√¥ng ƒë·ªß ƒë√°p ·ª©ng nhu c·∫ßu (d∆∞·ªõi ƒë·ªãnh m·ª©c)

## üìã User Stories

### US-1: Xem T·ªïng Quan C·∫£nh B√°o

**L√† Th·ªß Kho**, khi v√†o h·ªá th·ªëng:

- T√¥i mu·ªën th·∫•y ngay c√≥ bao nhi√™u l√¥ h√†ng ·ªü m·ª©c c·∫£nh b√°o ƒê·ªè/V√†ng
- Widget hi·ªÉn th·ªã s·ªë l∆∞·ª£ng c·∫£nh b√°o tr√™n Dashboard

### US-2: Danh S√°ch C·∫£nh B√°o HSD

**L√† Th·ªß Kho**, t√¥i mu·ªën:

- Xem danh s√°ch chi ti·∫øt c√°c l√¥ h√†ng c√≥ v·∫•n ƒë·ªÅ v·ªÅ h·∫°n s·ª≠ d·ª•ng
- Danh s√°ch ph√¢n lo·∫°i m√†u s·∫Øc r√µ r√†ng (ƒê·ªè/V√†ng/Xanh)
- S·∫Øp x·∫øp ∆∞u ti√™n l√¥ h·∫øt h·∫°n/s·∫Øp h·∫øt h·∫°n l√™n ƒë·∫ßu

### US-3: Danh S√°ch T·ªìn Kho Th·∫•p

**L√† Th·ªß Kho**, t√¥i mu·ªën:

- Xem danh s√°ch v·∫≠t t∆∞ c√≥ t·ªïng t·ªìn < m·ª©c t·ªëi thi·ªÉu
- Bi·∫øt c·∫ßn mua th√™m bao nhi√™u ƒë·ªÉ ƒë·ªß ƒë·ªãnh m·ª©c

## üé® Quy T·∫Øc C·∫£nh B√°o

### üìÖ C·∫£nh B√°o H·∫°n S·ª≠ D·ª•ng

```
Th·ªùi ƒëi·ªÉm: Ng√†y hi·ªán t·∫°i (Today)

üî¥ M·ª®C ƒê·ªé (Qu√° h·∫°n - Expired)
   HSD < Today
   ‚Üí B√°o nguy hi·ªÉm, kh√¥ng ƒë∆∞·ª£c xu·∫•t cho b·ªánh nh√¢n

üü° M·ª®C V√ÄNG (C·∫£nh b√°o - Warning)
   Today ‚â§ HSD ‚â§ Today + 6 th√°ng
   ‚Üí S·∫Øp h·∫øt h·∫°n, c·∫ßn ƒë·ªïi tr·∫£ NCC ho·∫∑c ƒë·∫©y h√†ng

üü¢ M·ª®C XANH (An to√†n - Safe)
   HSD > Today + 6 th√°ng
   ‚Üí Kh√¥ng hi·ªÉn th·ªã tr√™n b√°o c√°o c·∫£nh b√°o
```

### üìâ C·∫£nh B√°o T·ªìn Kho T·ªëi Thi·ªÉu

```
ƒêi·ªÅu ki·ªán:
- V·∫≠t t∆∞ c√≥ c√†i ƒë·∫∑t minStockLevel > 0
- T·ªïng t·ªìn kho hi·ªán t·∫°i < minStockLevel

‚ö†Ô∏è C·∫¢NH B√ÅO:
   Hi·ªÉn th·ªã v·∫≠t t∆∞ v·ªõi:
   - M·ª©c t·ªëi thi·ªÉu ƒë√£ c√†i ƒë·∫∑t
   - T·ªìn kho hi·ªán t·∫°i
   - S·ªë l∆∞·ª£ng thi·∫øu (c·∫ßn mua th√™m)
```

## üé® UI/UX Requirements

### Dashboard Widget

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ö†Ô∏è  C·∫¢NH B√ÅO KHO                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÖ H·∫°n S·ª≠ D·ª•ng:                          ‚îÇ
‚îÇ     üî¥ Qu√° h·∫°n:        5 l√¥               ‚îÇ
‚îÇ     üü° S·∫Øp h·∫øt h·∫°n:   12 l√¥               ‚îÇ
‚îÇ                                           ‚îÇ
‚îÇ  üìâ T·ªìn Kho Th·∫•p:      8 v·∫≠t t∆∞           ‚îÇ
‚îÇ                                           ‚îÇ
‚îÇ  [Xem Chi Ti·∫øt ‚Üí]                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### M√†n h√¨nh C·∫£nh B√°o HSD

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìÖ C·∫£nh B√°o H·∫°n S·ª≠ D·ª•ng                          [üîÑ Refresh]     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚òë Hi·ªÉn th·ªã m·ª©c Xanh (An to√†n)           üîç [T√¨m ki·∫øm v·∫≠t t∆∞...]   ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ‚ö†‚îÇ M√£ VT   ‚îÇ T√™n V·∫≠t T∆∞    ‚îÇ L√¥ NSX ‚îÇ HSD    ‚îÇ C√≤n ‚îÇ T·ªìn‚îÇ NCC‚îÇ ‚îÇ
‚îÇ  ‚îÇ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÇ ‚îÇ
‚îÇ  ‚îÇüî¥‚îÇ MAT0001 ‚îÇ Implant X     ‚îÇLOT123  ‚îÇ15/1/25 ‚îÇ -5d ‚îÇ 10 ‚îÇABC‚îÇ ‚îÇ
‚îÇ  ‚îÇüî¥‚îÇ MAT0003 ‚îÇ Composite Y   ‚îÇLOT456  ‚îÇ20/1/25 ‚îÇ  0d ‚îÇ  5 ‚îÇXYZ‚îÇ ‚îÇ
‚îÇ  ‚îÇüü°‚îÇ MAT0005 ‚îÇ Abutment Z    ‚îÇLOT789  ‚îÇ15/5/25 ‚îÇ120d ‚îÇ 20 ‚îÇABC‚îÇ ‚îÇ
‚îÇ  ‚îÇüü°‚îÇ MAT0002 ‚îÇ GƒÉng tay M    ‚îÇGLOVE20 ‚îÇ30/6/25 ‚îÇ165d ‚îÇ100 ‚îÇMNO‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                       [‚óÄ] Trang 1 / 2 [‚ñ∂]          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Ghi ch√∫:
- C·ªôt "C√≤n": S·ªë ng√†y c√≤n l·∫°i ƒë·∫øn HSD (s·ªë √¢m = ƒë√£ qu√° h·∫°n)
- S·∫Øp x·∫øp m·∫∑c ƒë·ªãnh: Theo HSD tƒÉng d·∫ßn (h·∫øt h·∫°n s·ªõm nh·∫•t ·ªü tr√™n)
```

### M√†n h√¨nh C·∫£nh B√°o T·ªìn Kho Th·∫•p

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìâ C·∫£nh B√°o T·ªìn Kho D∆∞·ªõi ƒê·ªãnh M·ª©c                [üîÑ Refresh]     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üîç [T√¨m ki·∫øm v·∫≠t t∆∞...]                                           ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ M√£ VT   ‚îÇ T√™n V·∫≠t T∆∞        ‚îÇ ƒêVT‚îÇ Min ‚îÇ T·ªìn ‚îÇ Thi·∫øu ‚îÇ B·ªô m√¥n‚îÇ ‚îÇ
‚îÇ  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ ‚îÇ
‚îÇ  ‚îÇ MAT0010 ‚îÇ B√¥ng bƒÉng y t·∫ø    ‚îÇ Kg‚îÇ 100 ‚îÇ  20 ‚îÇ   80  ‚îÇ Chung ‚îÇ ‚îÇ
‚îÇ  ‚îÇ MAT0015 ‚îÇ Composite 3M A3   ‚îÇ L·ªç‚îÇ  10 ‚îÇ   3 ‚îÇ    7  ‚îÇN·ªôi nha‚îÇ ‚îÇ
‚îÇ  ‚îÇ MAT0020 ‚îÇ Tr·ª• Implant 4.3mm ‚îÇC√°i‚îÇ  30 ‚îÇ  15 ‚îÇ   15  ‚îÇImplant‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  üí° G·ª£i √Ω: C·∫ßn l√™n k·∫ø ho·∫°ch mua s·∫Øm cho 3 v·∫≠t t∆∞ tr√™n              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Ghi ch√∫:
- C·ªôt "Thi·∫øu": = Min - T·ªìn (s·ªë l∆∞·ª£ng c·∫ßn mua th√™m t·ªëi thi·ªÉu)
- Highlight m√†u ƒë·ªè/v√†ng cho c·ªôt "T·ªìn" ƒë·ªÉ g√¢y ch√∫ √Ω
```

## üîß Functional Requirements

### FR-1: C·∫≠p Nh·∫≠t Schema Material

**C·∫ßn b·ªï sung tr∆∞·ªùng v√†o b·∫£ng Material**:

```prisma
model Material {
  // ... c√°c tr∆∞·ªùng hi·ªán t·∫°i

  // TH√äM M·ªöI
  minStockLevel   Decimal? @db.Decimal(15, 2) @default(0)
  // M·ª©c t·ªìn kho t·ªëi thi·ªÉu
  // Optional, m·∫∑c ƒë·ªãnh 0 = kh√¥ng c·∫£nh b√°o
  // Set > 0 ƒë·ªÉ k√≠ch ho·∫°t c·∫£nh b√°o cho v·∫≠t t∆∞ n√†y
}
```

### FR-2: Business Rules

#### C·∫£nh B√°o HSD:

1. **Ch·ªâ √°p d·ª•ng cho**: StockQuant c√≥ `quantity > 0` V√Ä `expiryDate != NULL`
2. **T√≠nh to√°n**:
   - `daysRemaining = DATEDIFF(day, TODAY, expiryDate)`
   - `status = RED if daysRemaining < 0`
   - `status = YELLOW if 0 <= daysRemaining <= 180` (6 th√°ng = 180 ng√†y)
   - `status = GREEN if daysRemaining > 180`
3. **S·∫Øp x·∫øp m·∫∑c ƒë·ªãnh**: Theo `expiryDate ASC` (h·∫øt h·∫°n s·ªõm nh·∫•t tr√™n ƒë·∫ßu)

#### C·∫£nh B√°o T·ªìn Th·∫•p:

1. **Ch·ªâ √°p d·ª•ng cho**: Material c√≥ `minStockLevel > 0`
2. **T√≠nh to√°n**:
   - `currentStock = SUM(StockQuant.quantity) WHERE materialId = X`
   - `shortage = minStockLevel - currentStock`
3. **ƒêi·ªÅu ki·ªán c·∫£nh b√°o**: `currentStock < minStockLevel`

### FR-3: API Endpoints

```
GET    /api/inventory/alerts/expiry?includeSafe=false          # C·∫£nh b√°o HSD
GET    /api/inventory/alerts/low-stock                         # C·∫£nh b√°o t·ªìn th·∫•p
GET    /api/inventory/alerts/summary                           # Widget dashboard
```

## üíæ Backend Logic

### API 1: C·∫£nh B√°o HSD

```typescript
// GET /api/inventory/alerts/expiry
async function getExpiryAlerts(includeSafe: boolean = false) {
  const today = new Date();
  const sixMonthsLater = addMonths(today, 6);

  const alerts = await prisma.stockQuant.findMany({
    where: {
      quantity: { gt: 0 },
      receiptDetail: {
        expiryDate: { not: null },
        // N·∫øu kh√¥ng includeSafe, ch·ªâ l·∫•y m·ª©c ƒê·ªè & V√†ng
        ...(!includeSafe && { expiryDate: { lte: sixMonthsLater } }),
      },
    },
    include: {
      material: {
        select: { code: true, name: true },
      },
      receiptDetail: {
        select: {
          batchNo: true,
          expiryDate: true,
          goodsReceipt: {
            select: {
              supplier: { select: { name: true } },
            },
          },
        },
      },
    },
    orderBy: {
      receiptDetail: { expiryDate: "asc" },
    },
  });

  // T√≠nh to√°n status & daysRemaining
  return alerts.map((alert) => {
    const expiryDate = alert.receiptDetail.expiryDate;
    const daysRemaining = differenceInDays(expiryDate, today);

    let status: "RED" | "YELLOW" | "GREEN";
    if (daysRemaining < 0) status = "RED";
    else if (daysRemaining <= 180) status = "YELLOW";
    else status = "GREEN";

    return {
      status,
      materialCode: alert.material.code,
      materialName: alert.material.name,
      batchNo: alert.receiptDetail.batchNo,
      expiryDate: alert.receiptDetail.expiryDate,
      daysRemaining,
      quantity: alert.quantity,
      supplierName: alert.receiptDetail.goodsReceipt.supplier.name,
    };
  });
}
```

### API 2: C·∫£nh B√°o T·ªìn Th·∫•p

```typescript
// GET /api/inventory/alerts/low-stock
async function getLowStockAlerts() {
  // L·∫•y t·∫•t c·∫£ v·∫≠t t∆∞ c√≥ c√†i ƒë·∫∑t ƒë·ªãnh m·ª©c
  const materials = await prisma.material.findMany({
    where: {
      minStockLevel: { gt: 0 },
      isActive: true,
    },
    include: {
      uom: { select: { value: true } },
      department: { select: { value: true } },
    },
  });

  const alerts = [];

  // V·ªõi m·ªói v·∫≠t t∆∞, t√≠nh t·ªìn kho hi·ªán t·∫°i
  for (const material of materials) {
    const stockSummary = await prisma.stockQuant.aggregate({
      where: { materialId: material.id },
      _sum: { quantity: true },
    });

    const currentStock = stockSummary._sum.quantity || 0;
    const shortage = material.minStockLevel - currentStock;

    // Ch·ªâ th√™m v√†o danh s√°ch n·∫øu thi·∫øu
    if (shortage > 0) {
      alerts.push({
        materialId: material.id,
        materialCode: material.code,
        materialName: material.name,
        uom: material.uom.value,
        department: material.department.value,
        minStockLevel: material.minStockLevel,
        currentStock,
        shortage,
      });
    }
  }

  // S·∫Øp x·∫øp theo m·ª©c ƒë·ªô thi·∫øu (cao ‚Üí th·∫•p)
  return alerts.sort((a, b) => b.shortage - a.shortage);
}
```

### API 3: Widget Summary

```typescript
// GET /api/inventory/alerts/summary
async function getAlertSummary() {
  const [expiryAlerts, lowStockAlerts] = await Promise.all([
    getExpiryAlerts(false), // Ch·ªâ l·∫•y ƒê·ªè & V√†ng
    getLowStockAlerts(),
  ]);

  const expiredCount = expiryAlerts.filter((a) => a.status === "RED").length;
  const expiringCount = expiryAlerts.filter(
    (a) => a.status === "YELLOW"
  ).length;

  return {
    expiry: {
      expired: expiredCount,
      expiring: expiringCount,
      total: expiredCount + expiringCount,
    },
    lowStock: {
      count: lowStockAlerts.length,
    },
  };
}
```

## ‚úÖ Validation & Rules

### Validation C·∫≠p Nh·∫≠t Material

```typescript
import { z } from "zod";

// Th√™m v√†o materialSchema hi·ªán t·∫°i
export const materialSchemaUpdated = materialSchema.extend({
  minStockLevel: z
    .number()
    .min(0, "M·ª©c t·ªëi thi·ªÉu kh√¥ng ƒë∆∞·ª£c √¢m")
    .max(999999, "Gi√° tr·ªã qu√° l·ªõn")
    .optional()
    .nullable()
    .default(0),
});
```

## üß™ Test Cases

### TC-1: C·∫£nh b√°o HSD - M·ª©c ƒê·ªè

- **Setup**: StockQuant c√≥ expiryDate = h√¥m qua
- **Expected**: Status = RED, daysRemaining = -1

### TC-2: C·∫£nh b√°o HSD - M·ª©c V√†ng

- **Setup**: expiryDate = 3 th√°ng sau
- **Expected**: Status = YELLOW, daysRemaining ‚âà 90

### TC-3: C·∫£nh b√°o HSD - Kh√¥ng hi·ªÉn th·ªã m·ª©c Xanh

- **Input**: GET /alerts/expiry (includeSafe=false)
- **Expected**: Kh√¥ng tr·∫£ v·ªÅ l√¥ c√≥ expiryDate > 6 th√°ng

### TC-4: C·∫£nh b√°o t·ªìn th·∫•p

- **Setup**: Material A c√≥ minStockLevel=50, t·ªìn hi·ªán t·∫°i=20
- **Expected**: Hi·ªÉn th·ªã c·∫£nh b√°o, shortage=30

### TC-5: Kh√¥ng c·∫£nh b√°o n·∫øu kh√¥ng c√†i ƒë·ªãnh m·ª©c

- **Setup**: Material B c√≥ minStockLevel=0, t·ªìn=5
- **Expected**: Kh√¥ng xu·∫•t hi·ªán trong danh s√°ch

### TC-6: Widget summary ƒë√∫ng

- **Setup**: 3 l√¥ ƒê·ªè, 5 l√¥ V√†ng, 2 v·∫≠t t∆∞ t·ªìn th·∫•p
- **Expected**: { expiry: {expired:3, expiring:5}, lowStock:{count:2} }

## üéØ Acceptance Criteria

- [ ] Widget dashboard hi·ªÉn th·ªã s·ªë l∆∞·ª£ng c·∫£nh b√°o ch√≠nh x√°c
- [ ] M√†n h√¨nh c·∫£nh b√°o HSD ph√¢n lo·∫°i m√†u ƒë√∫ng (ƒê·ªè/V√†ng/Xanh)
- [ ] S·∫Øp x·∫øp theo HSD tƒÉng d·∫ßn (h·∫øt h·∫°n s·ªõm ·ªü tr√™n)
- [ ] C·ªôt "C√≤n" hi·ªÉn th·ªã s·ªë ng√†y ƒë√∫ng (√¢m n·∫øu qu√° h·∫°n)
- [ ] M√†n h√¨nh t·ªìn th·∫•p ch·ªâ hi·ªÉn th·ªã v·∫≠t t∆∞ c√≥ minStockLevel > 0
- [ ] T√≠nh to√°n "Thi·∫øu" = Min - T·ªìn ch√≠nh x√°c
- [ ] Checkbox "Hi·ªán m·ª©c Xanh" ho·∫°t ƒë·ªông
- [ ] API performance t·ªët (< 2s v·ªõi 500+ l√¥ h√†ng)
- [ ] C√≥ th·ªÉ t√¨m ki·∫øm/filter trong c·∫£ 2 m√†n h√¨nh

## üì± Mobile Responsive

- Widget dashboard hi·ªÉn th·ªã compact tr√™n mobile
- Table alerts scroll ngang n·∫øu c·∫ßn
- ∆Øu ti√™n hi·ªÉn th·ªã c·ªôt quan tr·ªçng nh·∫•t (T√™n VT, HSD, T·ªìn)

## üîó Integration

### V·ªõi Module Kh√°c:

- **Dashboard**: Widget c·∫£nh b√°o t√≠ch h·ª£p v√†o trang ch·ªß
- **Material Management**: Link t·ª´ c·∫£nh b√°o ‚Üí Form s·ª≠a Material (ƒë·ªÉ c·∫≠p nh·∫≠t minStockLevel)
- **Purchase Planning** (Phase 3): S·ª≠ d·ª•ng danh s√°ch low-stock ƒë·ªÉ g·ª£i √Ω mua h√†ng

---

**Priority**: üü° High (An to√†n v·∫≠n h√†nh, ƒë·∫∑c bi·ªát quan tr·ªçng cho y t·∫ø)  
**Estimated Effort**: 2-3 ng√†y  
**Dependencies**: 015.3 Material (c·∫ßn th√™m minStockLevel), 015.4 GRN (c·∫ßn StockQuant)
