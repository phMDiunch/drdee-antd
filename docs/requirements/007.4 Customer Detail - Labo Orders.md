# ğŸ§© Requirements: Customer Detail - Labo Orders Tab

> **ğŸ“Š STATUS: PLANNING** - Specification phase  
> **ğŸ“„ Related Documents**:
>
> - Base: `007.1 Customer Detail.md`
> - Pattern Reference: `009 Consulted-Service.md`
> - Labo Base: `016 Labo Management - Overview.md`, `016.3 Labo Orders - Daily View.md`  
>   **ğŸ”— Implementation**: `src/features/customers/components/LaboOrdersTab/`, `src/features/labo-orders/`

## ğŸ“Š Tham kháº£o Pattern

**Pattern gá»‘c**: Tab Consulted Service trong Customer Detail (Ä‘Ã£ implement)

- Table hiá»ƒn thá»‹ danh sÃ¡ch consulted services cá»§a khÃ¡ch hÃ ng
- Filter, sort, search capabilities
- Quick actions (view, edit, delete)
- Summary statistics
- Create new service from tab

**Ãp dá»¥ng cho Labo Orders**:

- TÆ°Æ¡ng tá»± pattern nhÆ°ng cho labo orders
- Hiá»ƒn thá»‹ táº¥t cáº£ Ä‘Æ¡n hÃ ng labo cá»§a khÃ¡ch hÃ ng (cross-clinic)
- Filter theo clinic, order type, status (sent/returned)
- Quick actions (view, edit, receive, delete)

---

## ğŸ¯ Má»¥c TiÃªu & Pháº¡m Vi

### Má»¥c Ä‘Ã­ch

Tab "ÄÆ¡n HÃ ng Labo" trong Customer Detail cung cáº¥p:

- **Xem tá»•ng quan**: Táº¥t cáº£ labo orders cá»§a khÃ¡ch hÃ ng
- **Quáº£n lÃ½ nhanh**: Create, edit, receive, delete orders
- **Thá»‘ng kÃª**: Tá»•ng chi phÃ­, sá»‘ lÆ°á»£ng Ä‘Æ¡n hÃ ng
- **Filter/Search**: TÃ¬m kiáº¿m theo nhiá»u tiÃªu chÃ­
- **Cross-clinic view**: Xem Ä‘Æ¡n hÃ ng tá»« táº¥t cáº£ chi nhÃ¡nh

### User Stories

#### US-1: NhÃ¢n viÃªn xem labo orders cá»§a khÃ¡ch hÃ ng

```
AS a employee
I WANT TO xem táº¥t cáº£ labo orders cá»§a khÃ¡ch hÃ ng
SO THAT tÃ´i cÃ³ thá»ƒ theo dÃµi lá»‹ch sá»­ lÃ m rÄƒng giáº£
```

#### US-2: NhÃ¢n viÃªn táº¡o Ä‘Æ¡n hÃ ng labo má»›i cho khÃ¡ch hÃ ng

```
AS a employee
I WANT TO táº¡o Ä‘Æ¡n hÃ ng labo má»›i tá»« customer detail
SO THAT tÃ´i khÃ´ng cáº§n chuyá»ƒn sang trang khÃ¡c
```

#### US-3: NhÃ¢n viÃªn xÃ¡c nháº­n nháº­n máº«u

```
AS a employee
I WANT TO quickly receive labo order
SO THAT cáº­p nháº­t status nhanh chÃ³ng
```

#### US-4: Admin thá»‘ng kÃª chi phÃ­ labo

```
AS an admin
I WANT TO xem tá»•ng chi phÃ­ labo cá»§a khÃ¡ch hÃ ng
SO THAT Ä‘Ã¡nh giÃ¡ giÃ¡ trá»‹ khÃ¡ch hÃ ng
```

### Äá»‘i tÆ°á»£ng sá»­ dá»¥ng

- **NhÃ¢n viÃªn**: Xem, táº¡o, nháº­n máº«u orders cá»§a clinic mÃ¬nh
- **Admin**: Full access, xem táº¥t cáº£ clinic, thá»‘ng kÃª toÃ n diá»‡n

---

## 1. ğŸ”Œ API Requirements

### 1.1 Reuse Existing API Endpoint

**Pattern**: Giá»‘ng consulted service, KHÃ”NG táº¡o endpoint riÃªng. DÃ¹ng láº¡i endpoint hiá»‡n cÃ³ vá»›i filter `customerId`.

**Endpoint**: `GET /api/v1/labo-orders/daily?customerId={id}`

#### Query Parameters

```typescript
interface GetDailyLaboOrdersQuery {
  // Required for customer view
  customerId?: string; // Filter by customer ID

  // Existing params (already implemented)
  date: string; // ISO date
  type: "sent" | "returned"; // Daily view type
  clinicId?: string; // Filter by clinic
}
```

#### Response

```typescript
// Reuse existing LaboOrdersDailyResponse
interface LaboOrdersDailyResponse {
  items: LaboOrderResponse[];
  count: number;
  statistics: {
    total: number;
    sent: number;
    returned: number;
    totalCost: number;
    warrantyOrders: number;
    newOrders: number;
  };
}
```

#### Business Rules

- **Reuse existing endpoint**: `/api/v1/labo-orders/daily` already supports `customerId` filter
- **Cross-clinic access**: Employee xem táº¥t cáº£ orders cá»§a customer (khÃ´ng giá»›i háº¡n clinic)
- **No new backend code needed**: Service/Repo already handle customerId filter
- **Frontend only**: Chá»‰ cáº§n táº¡o hook wrapper vÃ  component

#### Permission Rules

```typescript
// Same as existing labo-orders permission
// Employee: View all orders
// Admin: Full access
```

---

## 2. ğŸ“Š UI/UX Requirements

### 2.1 Layout Structure

**Pattern**: Giá»‘ng ConsultedServicesTab - Simple layout vá»›i header + table only

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: "Danh sÃ¡ch Ä‘Æ¡n hÃ ng labo (12)"    [+ Táº¡o Ä‘Æ¡n má»›i]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Table: Labo Orders (reuse LaboOrdersTable component)        â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚STTâ”‚NgÃ y â”‚Loáº¡i  â”‚XÆ°á»Ÿng   â”‚Item   â”‚SLâ”‚GiÃ¡  â”‚Status â”‚Act. â”‚â”‚
â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ 1 â”‚10/12â”‚Má»›i   â”‚Vina    â”‚Crown  â”‚2 â”‚1.2M â”‚ChÆ°a vá»â”‚ ... â”‚â”‚
â”‚ â”‚ 2 â”‚08/12â”‚BH    â”‚DentLab â”‚Bridge â”‚1 â”‚  0Ä‘ â”‚ÄÃ£ vá»  â”‚ ... â”‚â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Differences from Daily View:**

- âŒ No filters (customer already selected)
- âŒ No summary cards (keep it simple like consulted services)
- âŒ No pagination (load all, pageSize: 100)
- âœ… Reuse existing LaboOrdersTable component with `isCustomerDetailView` prop
- âœ… Simple header with count + create button

### 2.2 Table Component

**Component**: Reuse existing `LaboOrdersTable` from `@/features/labo-orders`

**Props**:

```typescript
<LaboOrdersTable
  data={orders}
  loading={isLoading}
  isCustomerDetailView={true} // Hide customer column only
  onReceive={handleReceive}
  onEdit={handleEdit}
  onDelete={handleDelete}
  actionLoading={receiveLoading}
/>
```

**Note**: Giá»¯ nguyÃªn táº¥t cáº£ columns cá»§a table hiá»‡n cÃ³ (bao gá»“m STT, Chi phÃ­, Tráº¡ng thÃ¡i), chá»‰ áº©n column "KhÃ¡ch hÃ ng" khi `isCustomerDetailView={true}`

**Receive Button Logic**: Button "Nháº­n máº«u" náº±m trong column "NgÃ y Nháº­n Máº«u" (returnDate column):

- ChÆ°a nháº­n máº«u (returnDate === null): Hiá»ƒn thá»‹ button "Nháº­n máº«u"
- ÄÃ£ nháº­n máº«u (returnDate !== null): Hiá»ƒn thá»‹ ngÃ y nháº­n máº«u

### 2.3 Action Buttons

Giá»¯ nguyÃªn action buttons hiá»‡n cÃ³ cá»§a table:

```typescript
interface ActionButtons {
  actions: [
    {
      key: "edit";
      icon: <EditOutlined />;
      tooltip: "Chá»‰nh sá»­a";
      permission: "labo-orders:update";
      onClick: () => handleEdit(record);
    },
    {
      key: "delete";
      icon: <DeleteOutlined />;
      tooltip: "XÃ³a";
      permission: "labo-orders:delete";
      danger: true;
      confirm: {
        title: "XÃ³a Ä‘Æ¡n hÃ ng labo?";
        description: "HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c";
      };
      onClick: () => handleDelete(record.id);
    },
  ];
}
```

**Note**:

- âŒ KhÃ´ng cÃ³ button "Xem chi tiáº¿t" (view)
- âŒ Button "Nháº­n máº«u" khÃ´ng náº±m á»Ÿ action column, mÃ  náº±m á»Ÿ column "NgÃ y Nháº­n Máº«u"

---

## 3. ğŸ¨ Component Architecture

### 3.1 Component Structure

**Pattern**: Giá»‘ng ConsultedServicesTab - Single file component, reuse existing components

```
src/features/customers/components/detail-tabs/
â””â”€â”€ LaboOrdersTab.tsx              # Main container (single file)

# Reuse from @/features/labo-orders:
- LaboOrdersTable (existing, add isCustomerDetailView prop)
- CreateLaboOrderModal (existing)
- UpdateLaboOrderModal (existing)
```

**Note**: KhÃ´ng cáº§n táº¡o folder riÃªng, follow pattern cá»§a ConsultedServicesTab

### 3.2 Props Interface

```typescript
// LaboOrdersTab.tsx - Match ConsultedServicesTab pattern
interface LaboOrdersTabProps {
  customerId: string;
  customerCode: string;
  customerName: string;
  clinicId: string;
  onDataChange?: () => void; // Trigger parent refresh
}
```

### 3.3 Implementation (Match ConsultedServicesTab Pattern)

```typescript
// src/features/customers/components/detail-tabs/LaboOrdersTab.tsx
"use client";

import React, { useCallback, useEffect, useMemo, useState } from "react";
import { Button, Col, Row, Typography } from "antd";
import { PlusOutlined } from "@ant-design/icons";
import {
  useLaboOrdersByCustomer,
  useCreateLaboOrder,
  useUpdateLaboOrder,
  useDeleteLaboOrder,
  useReceiveLaboOrder,
  LaboOrdersTable,
  CreateLaboOrderModal,
  UpdateLaboOrderModal,
} from "@/features/labo-orders";
import type {
  LaboOrderResponse,
  CreateLaboOrderRequest,
  UpdateLaboOrderRequest,
} from "@/shared/validation/labo-order.schema";

interface LaboOrdersTabProps {
  customerId: string;
  customerCode: string;
  customerName: string;
  clinicId: string;
  onDataChange?: () => void;
}

export default function LaboOrdersTab({
  customerId,
  customerCode,
  customerName,
  clinicId,
  onDataChange,
}: LaboOrdersTabProps) {
  // Data fetching
  const { data, isLoading } = useLaboOrdersByCustomer(customerId);
  const orders = useMemo(() => data?.items ?? [], [data?.items]);

  // Modal state
  const [createModalOpen, setCreateModalOpen] = useState(false);
  const [editingOrder, setEditingOrder] = useState<LaboOrderResponse | null>(
    null
  );

  // Mutations
  const createMutation = useCreateLaboOrder();
  const updateMutation = useUpdateLaboOrder();
  const deleteMutation = useDeleteLaboOrder();
  const receiveMutation = useReceiveLaboOrder();

  // Handlers
  const handleCreate = useCallback(() => {
    setCreateModalOpen(true);
  }, []);

  const handleCreateSubmit = useCallback(
    (data: CreateLaboOrderRequest) => {
      createMutation.mutate(data);
    },
    [createMutation]
  );

  // Close modal on success
  useEffect(() => {
    if (createMutation.isSuccess) {
      setCreateModalOpen(false);
      onDataChange?.();
    }
  }, [createMutation.isSuccess, onDataChange]);

  const handleEdit = useCallback((order: LaboOrderResponse) => {
    setEditingOrder(order);
  }, []);

  const handleUpdateSubmit = useCallback(
    (_id: string, payload: UpdateLaboOrderRequest) => {
      if (!editingOrder) return;
      updateMutation.mutate({ id: editingOrder.id, data: payload });
    },
    [editingOrder, updateMutation]
  );

  // Close modal on success
  useEffect(() => {
    if (updateMutation.isSuccess) {
      setEditingOrder(null);
      onDataChange?.();
    }
  }, [updateMutation.isSuccess, onDataChange]);

  const handleDelete = useCallback(
    (id: string) => {
      deleteMutation.mutate(id);
    },
    [deleteMutation]
  );

  const handleReceive = useCallback(
    (id: string) => {
      receiveMutation.mutate(id);
    },
    [receiveMutation]
  );

  // Trigger data change on success
  useEffect(() => {
    if (deleteMutation.isSuccess || receiveMutation.isSuccess) {
      onDataChange?.();
    }
  }, [deleteMutation.isSuccess, receiveMutation.isSuccess, onDataChange]);

  return (
    <div>
      {/* Header */}
      <Row justify="space-between" align="middle" style={{ marginBottom: 16 }}>
        <Col>
          <Typography.Title level={5} style={{ margin: 0 }}>
            Danh sÃ¡ch Ä‘Æ¡n hÃ ng labo ({orders.length})
          </Typography.Title>
        </Col>
        <Col>
          <Button type="primary" icon={<PlusOutlined />} onClick={handleCreate}>
            Táº¡o Ä‘Æ¡n má»›i
          </Button>
        </Col>
      </Row>

      {/* Table */}
      <LaboOrdersTable
        data={orders}
        loading={
          isLoading || deleteMutation.isPending || receiveMutation.isPending
        }
        isCustomerDetailView={true}
        onReceive={handleReceive}
        onEdit={handleEdit}
        onDelete={handleDelete}
        actionLoading={receiveMutation.isPending}
      />

      {/* Create Modal */}
      {createModalOpen && (
        <CreateLaboOrderModal
          open={createModalOpen}
          customer={{
            id: customerId,
            customerCode,
            fullName: customerName,
          }}
          clinicId={clinicId}
          onCancel={() => setCreateModalOpen(false)}
          onSubmit={handleCreateSubmit}
          confirmLoading={createMutation.isPending}
        />
      )}

      {/* Update Modal */}
      {editingOrder && (
        <UpdateLaboOrderModal
          open={!!editingOrder}
          order={editingOrder}
          onCancel={() => setEditingOrder(null)}
          onSubmit={handleUpdateSubmit}
          confirmLoading={updateMutation.isPending}
        />
      )}
    </div>
  );
}
```

---

## 4. ğŸ”§ Backend Changes

### 4.1 No New Backend Code Needed

**Pattern**: Consulted service khÃ´ng táº¡o backend riÃªng, labo order cÅ©ng váº­y.

âœ… **Existing endpoint already supports customerId filter**:

- `GET /api/v1/labo-orders/daily?customerId={id}` - Already implemented
- Service layer already handles customerId in `list()` method
- Repository already supports customerId filter in `getDailyLaboOrders()`

âŒ **No need to create**:

- New API endpoint `/api/v1/labo-orders/by-customer/[customerId]`
- New service method `getByCustomer()`
- New repository method `getByCustomer()`
- New schema `GetLaboOrdersByCustomerQuerySchema`

### 4.2 Optional Enhancement (Future)

If `customerId` filter is not yet supported in `/api/v1/labo-orders/daily`, add it to existing code:

**Schema** (`src/shared/validation/labo-order.schema.ts`):

```typescript
export const GetDailyLaboOrdersQuerySchema = z.object({
  date: z.string(),
  type: z.enum(["sent", "returned"]),
  clinicId: z.string().uuid().optional(),
  customerId: z.string().uuid().optional(), // âœ¨ ADD THIS
});
```

**Service** (already handles any query params passed to repo)
**Repository** (add customerId to where clause if provided)

---

## 5. ğŸ£ Frontend Hooks

### 5.1 Query Hook (Match ConsultedServicesTab Pattern)

**File**: `src/features/labo-orders/hooks/useLaboOrdersByCustomer.ts`

```typescript
"use client";

import { useQuery } from "@tanstack/react-query";
import { getDailyLaboOrdersApi } from "../api";

/**
 * Hook to fetch labo orders for a specific customer
 * Used in Customer Detail page
 * Pattern: Same as useConsultedServicesByCustomer
 */
export function useLaboOrdersByCustomer(customerId: string) {
  return useQuery({
    queryKey: ["labo-orders", "customer", customerId],
    queryFn: () =>
      getDailyLaboOrdersApi({
        customerId, // Filter by customer
        // Note: date/type may need adjustment based on backend
        // If backend requires date, pass current date or make it optional
      }),
    enabled: !!customerId,
  });
}
```

**Note**: If `getDailyLaboOrdersApi` requires `date` and `type` params, update schema to make them optional when `customerId` is provided.

---

## 6. ğŸ¨ Component Reuse

### 6.1 Reuse Existing Components

**From `@/features/labo-orders`**:

- âœ… `LaboOrdersTable` - Add `isCustomerDetailView` prop to hide customer column
- âœ… `CreateLaboOrderModal` - Already accepts customer pre-fill
- âœ… `UpdateLaboOrderModal` - Already implemented

### 6.2 LaboOrdersTable Enhancement

**File**: `src/features/labo-orders/components/LaboOrdersTable.tsx`

Add optional prop:

```typescript
interface LaboOrdersTableProps {
  // ... existing props
  isCustomerDetailView?: boolean; // NEW: Hide customer column when true
}
```

Implementation:

```typescript
const columns = [
  // ... other columns
  {
    key: "customer",
    title: "KhÃ¡ch hÃ ng",
    visible: !isCustomerDetailView, // Hide in customer detail
    // ...
  },
  // ... rest of columns
].filter((col) => col.visible !== false);
```

---

## 7. ğŸ” Permission Requirements

### 7.1 Permission Definitions

```typescript
// In permission files
export const laboOrderPermissions = {
  view: ["admin", "employee"], // Xem danh sÃ¡ch
  create: ["admin", "employee"], // Táº¡o má»›i
  update: ["admin", "employee"], // Chá»‰nh sá»­a (cÃ³ Ä‘iá»u kiá»‡n)
  delete: ["admin"], // XÃ³a (admin only)
  receive: ["admin", "employee"], // XÃ¡c nháº­n nháº­n máº«u
};
```

### 7.2 Client-side Permission Checks

```typescript
// In ActionButtons component
const canReceive =
  hasPermission("labo-orders:receive") && record.returnDate === null;

const canEdit =
  hasPermission("labo-orders:update") &&
  (currentUser.role === "admin" || record.returnDate === null);

const canDelete = hasPermission("labo-orders:delete");
```

---

## 8. âš¡ Performance Considerations

**Pattern**: Giá»‘ng consulted service - Simple caching, khÃ´ng cÃ³ pagination/prefetch phá»©c táº¡p

### 8.1 Caching Strategy

```typescript
// Query hook: useLaboOrdersByCustomer
queryKey: ["labo-orders", "customer", customerId],
staleTime: 60 * 1000, // 1 minute (transactional data)
gcTime: 5 * 60 * 1000, // 5 minutes
refetchOnWindowFocus: true, // Refresh when user returns
enabled: !!customerId,

// Invalidate on mutations
queryClient.invalidateQueries({
  queryKey: ["labo-orders", "customer", customerId]
});
```

### 8.2 Load All Data

```typescript
// No pagination - load all orders for customer
pageSize: 100, // Sufficient for most customers
// If customer has > 100 orders, consider lazy loading
```

---

## 9. ğŸ§ª Testing Requirements

### 9.1 Unit Tests

```typescript
describe("LaboOrdersTab", () => {
  test("renders table with customer orders", () => {});
  test("hides customer column in table", () => {});
  test("shows receive button for unreturned orders", () => {});
  test("displays return date for returned orders", () => {});
  test("handles create/edit/delete mutations", () => {});
  test("triggers onDataChange callback after mutations", () => {});
});
```

### 9.2 Integration Tests

```typescript
describe("Labo Orders Tab Integration", () => {
  test("fetches and displays orders on mount", () => {});
  test("refetches data after create/edit/delete", () => {});
  test("handles API errors gracefully", () => {});
  test("respects permissions for actions", () => {});
});
```

---

## 10. ğŸ“‹ Technical Notes

### 10.1 Table Column Visibility

```typescript
// In LaboOrdersTable component
const columns = [
  // ... other columns
  {
    key: "customer",
    title: "KhÃ¡ch hÃ ng",
    // Hide when viewing from customer detail page
    ...(isCustomerDetailView && { className: "hidden" }),
  },
].filter((col) => !col.hidden);
```

### 10.2 Receive Button in returnDate Column

```typescript
// Column "NgÃ y Nháº­n Máº«u"
{
  key: "returnDate",
  title: "NgÃ y Nháº­n Máº«u",
  render: (returnDate, record) => {
    if (returnDate) {
      // ÄÃ£ nháº­n - hiá»ƒn thá»‹ ngÃ y
      return dayjs(returnDate).format("DD/MM/YYYY");
    }
    // ChÆ°a nháº­n - hiá»ƒn thá»‹ button
    return (
      <Button
        size="small"
        type="link"
        onClick={() => onReceive(record.id)}
        loading={actionLoading}
      >
        Nháº­n máº«u
      </Button>
    );
  },
}
```

### 10.3 Cross-clinic View Notes

```typescript
// Employee cÃ³ thá»ƒ xem táº¥t cáº£ orders cá»§a customer
// nhÆ°ng chá»‰ Ä‘Æ°á»£c create/edit/delete orders cá»§a clinic mÃ¬nh
const canEdit = (order: LaboOrderResponse) => {
  if (currentUser.role === "admin") return true;
  return order.clinicId === currentUser.clinicId;
};
```

---

## 11. âœ… Definition of Done

**Backend (Minimal Changes):**

- [ ] Verify `/api/v1/labo-orders/daily` supports `customerId` filter
- [ ] If not, add `customerId` to `GetDailyLaboOrdersQuerySchema`
- [ ] Update repository where clause to filter by customerId
- [ ] Test API endpoint with `?customerId=xxx` param

**Frontend:**

- [ ] Hook `useLaboOrdersByCustomer()` created in `src/features/labo-orders/hooks/`
- [ ] Component `LaboOrdersTab.tsx` created in `src/features/customers/components/detail-tabs/`
- [ ] `LaboOrdersTable` component updated with `isCustomerDetailView` prop
- [ ] Create/Update modals reused from labo-orders feature
- [ ] Action buttons (receive, edit, delete) working
- [ ] Mutations trigger `onDataChange()` callback
- [ ] Loading/Error states handled
- [ ] Export from `src/features/labo-orders/index.ts`

**Integration:**

- [ ] Tab added to Customer Detail page
- [ ] Data refreshes after mutations
- [ ] Cross-clinic view working (see all orders)
- [ ] Permissions enforced (client-side)
- [ ] Responsive design working
- [ ] Code reviewed
- [ ] Pattern matches ConsultedServicesTab 100%

---

**Document Version**: 2.0  
**Updated**: December 10, 2025  
**Status**: Ready for Implementation  
**Estimated Effort**: 0.5-1 day

- Backend: 0-0.5 days (only if customerId filter not yet supported)
- Frontend: 0.5 days (hook + component, reuse existing table/modals)

**Dependencies**:

- Labo Orders base feature (implemented âœ…)
- Customer Detail base layout (implemented âœ…)
- Consulted Service tab pattern (reference âœ…)
