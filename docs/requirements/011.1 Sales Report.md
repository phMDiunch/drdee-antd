# ğŸ§© Requirements: Sales Dashboard (Dashboard Doanh sá»‘)

> **ğŸ“‹ STATUS: âœ… IMPLEMENTED** - Modern dashboard vá»›i Chart.js  
> **ğŸ”— Implementation**: `src/features/reports/sales/`  
> **ğŸ”§ Last Updated**: 2025-11-14 - Triá»ƒn khai thá»±c táº¿
> **ğŸ“± Route**: `/dashboard/sales`

## ğŸ“Š Tham kháº£o

- Prisma Models: `ConsultedService`, `Customer`, `Employee`, `DentalService`, `Clinic`
- Related: `009 Consulted-Service.md`, `006 Dental Service.md`
- UI Library: Ant Design 5.x, Chart.js 4.x, react-chartjs-2
- Old Spec: `docs/requirements/011 Report.md` (deprecated)

## ğŸ¯ Má»¥c TiÃªu

Dashboard Doanh sá»‘ lÃ  trang phÃ¢n tÃ­ch tá»•ng quan vá»›i **visualization hiá»‡n Ä‘áº¡i** cho giÃ¡ trá»‹ dá»‹ch vá»¥ Ä‘Ã£ chá»‘t, bao gá»“m:

### Core Features (ÄÃ£ triá»ƒn khai)

1. **ğŸ” Filter Bar**:

   - Month picker (chá»n thÃ¡ng phÃ¢n tÃ­ch)
   - Clinic selector (chá»n chi nhÃ¡nh)
   - Sale consultant selector (lá»c theo sale)
   - Doctor consultant selector (lá»c theo bÃ¡c sÄ©)

2. **ğŸ“Š KPI Cards** (4 cards):

   - Tá»•ng doanh sá»‘ vá»›i growth indicator
   - Sá»‘ ca chá»‘t vá»›i growth indicator
   - Doanh sá»‘ TB/ca vá»›i growth indicator
   - KhÃ¡ch má»›i vs CÅ© (breakdown)

3. **ğŸ“ˆ Charts** (3 charts):

   - Line Chart: Doanh sá»‘ theo ngÃ y (30 days trend)
   - Pie Chart: CÆ¡ cáº¥u theo nguá»“n khÃ¡ch hÃ ng (5 sources)
   - Bar Chart: Doanh sá»‘ theo dá»‹ch vá»¥ (top 5 services)

4. **ğŸ“‹ Sales Performance Table**:

   - Ranking top sales vá»›i trophy icons
   - Metrics: Assigned/Consulted/Closed cases
   - Revenue vÃ  closing rate

5. **ğŸ“‘ Detail Tabs** (5 tabs):

   - Tab 1: Theo ngÃ y (daily breakdown)
   - Tab 2: Theo nguá»“n (source analysis)
   - Tab 3: Theo dá»‹ch vá»¥ (service category)
   - Tab 4: Theo sale tÆ° váº¥n (sale performance detail)
   - Tab 5: Theo bÃ¡c sÄ© tÆ° váº¥n (doctor consultation rate)

6. **ğŸ“¤ Export Actions**:
   - Excel export button
   - PDF export button (UI ready)

**Technology Stack**:

- UI Framework: Ant Design 5.27.3
- Charts: Chart.js 4.5.1 + react-chartjs-2 5.3.1
- Date handling: dayjs
- State: React useState (local state)

**Äá»‘i tÆ°á»£ng ngÆ°á»i dÃ¹ng**:

- Táº¥t cáº£ users cÃ³ quyá»n truy cáº­p `/dashboard/sales`
- Filter theo clinic/sale/doctor tÃ¹y role

---

## ğŸ² Decision Log

### UI/UX Decisions (Implemented)

- âœ… **Single Page Dashboard**: KhÃ´ng dÃ¹ng tabs cho clinics, dÃ¹ng Select filter thay vÃ¬
- âœ… **Chart Library**: Chá»n Chart.js vÃ¬ performance tá»‘t vá»›i Canvas rendering
  - Bundle size: ~260KB (nhá» hÆ¡n Recharts ~430KB)
  - Animation mÆ°á»£t mÃ  hÆ¡n
  - Tooltips customizable
- âœ… **Layout**: Card-based vá»›i shadow vÃ  border radius
  - KhÃ´ng cÃ³ background color riÃªng (dÃ¹ng AppLayout background)
  - Cards cÃ³ `variant="borderless"` (Ant Design 5.x)
- âœ… **KPI Cards**: 4 cards vá»›i growth indicators
  - Color-coded: Blue (sales), Green (deals), Purple (average), Mixed (customer type)
  - Growth arrow: Up (green) / Down (red) vs thÃ¡ng trÆ°á»›c
- âœ… **Responsive Grid**:
  - KPI Cards: 4 columns (lg), 2 columns (sm), 1 column (xs)
  - Charts: Pie (10 cols) + Bar (14 cols) trÃªn desktop
  - Mobile: Stack vertically

### Data & Business Logic (To Implement)

- ğŸ”„ **Data Source**: `ConsultedService` vá»›i Ä‘iá»u kiá»‡n:
  - `serviceStatus = "ÄÃ£ chá»‘t"`
  - `serviceConfirmDate` trong thÃ¡ng Ä‘Æ°á»£c chá»n
- ğŸ”„ **Mock Data**: Hiá»‡n dÃ¹ng mock data, cáº§n thay báº±ng API
- ğŸ”„ **Filters**: 4 filters (month, clinic, sale, doctor)
  - Filters cascade: Clinic â†’ filter sales & doctors
- ğŸ”„ **Export**: UI ready, cáº§n implement logic vá»›i ExcelJS

### Component Architecture

- âœ… **Feature-based structure**: `features/reports/sales/`
- âœ… **Separation of concerns**:
  - `SalesDashboard.tsx`: Main orchestrator
  - Individual chart components: `DailyRevenueChart`, `RevenueBySourceChart`, `RevenueByServiceBar`
  - Table components: `SaleTable`, `TabsDetail`
  - Filter component: `FilterBar`
  - Metrics: `KpiCards`
- âœ… **Type safety**: Äáº§y Ä‘á»§ TypeScript types trong `types.ts`
- âœ… **Reusable**: CÃ¡c component Ä‘á»™c láº­p, cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng

---

## 1. ğŸ¨ UI Components (ÄÃ£ triá»ƒn khai)

### 1.1 Layout Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppLayout (tráº¯ng background)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FilterBar Card (white, shadow)                      â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ [Month] [Clinic] [Sale] [Dr] â”‚ [Excel] [PDF]  â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Tá»•ng DS â”‚ â”‚ Ca chá»‘t â”‚ â”‚ TB/ca   â”‚ â”‚ Má»›i/CÅ©  â”‚ (KPI) â”‚
â”‚  â”‚ 1.25B â‚« â”‚ â”‚ 156     â”‚ â”‚ 8.01M â‚« â”‚ â”‚ 680M/   â”‚        â”‚
â”‚  â”‚ â†‘+12.5% â”‚ â”‚ â†‘+8.3%  â”‚ â”‚ â†‘+3.8%  â”‚ â”‚ 570M    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ˆ Line Chart: Doanh sá»‘ theo ngÃ y                  â”‚  â”‚
â”‚  â”‚ [Gradient blue line with 30 data points]           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ° Pie Chart â”‚ â”‚ ğŸ“Š Horizontal Bar Chart            â”‚ â”‚
â”‚  â”‚ Nguá»“n KH     â”‚ â”‚ Doanh sá»‘ theo DV                   â”‚ â”‚
â”‚  â”‚ 5 sources    â”‚ â”‚ Top 5 services                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ† Sales Performance Table                         â”‚  â”‚
â”‚  â”‚ Rank | Sale | Assigned | Consulted | Closed | Rev â”‚  â”‚
â”‚  â”‚ #1 ğŸ†| A    | 85       | 78        | 52     | 420Mâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“‘ Detail Tabs                                      â”‚  â”‚
â”‚  â”‚ [NgÃ y] [Nguá»“n] [Dá»‹ch vá»¥] [Sale] [BÃ¡c sÄ©]          â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚ <Table data for active tab>                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 FilterBar Component

**File**: `src/features/reports/sales/components/FilterBar.tsx` âœ…

**Features**:

- **Month Picker**: Ant Design DatePicker vá»›i `picker="month"`
  - Format: "MM/YYYY"
  - Value format: "YYYY-MM"
  - Default: Current month (tá»« state)
- **Clinic Select**: Dropdown vá»›i "Táº¥t cáº£ chi nhÃ¡nh" option
  - AllowClear: true
  - Width: 180px
  - Mock data: 3 clinics (HN, HCM, DN)
- **Sale Select**: Dropdown "Táº¥t cáº£ sale"
  - AllowClear: true
  - Width: 180px
  - Mock data: 3 sales (A, B, C)
- **Doctor Select**: Dropdown "Táº¥t cáº£ bÃ¡c sÄ©"
  - AllowClear: true
  - Width: 180px
  - Mock data: 3 doctors (BS. D, E, F)

**Layout**: Horizontal Space vá»›i labels trÃªn má»—i filter

**Props**:

```typescript
interface FilterBarProps {
  filters: DashboardFilters;
  onChange: (filters: Partial<DashboardFilters>) => void;
}
```

**State Management**: Lifted state tá»« SalesDashboard

---

### 1.3 KpiCards Component

**File**: `src/features/reports/sales/components/KpiCards.tsx` âœ…

**Layout**: Row vá»›i 4 columns responsive

- lg: 6 cols (4 cards/row)
- sm: 12 cols (2 cards/row)
- xs: 24 cols (1 card/row)

**Cards**:

1. **Tá»•ng doanh sá»‘**:

   - Icon: DollarOutlined (blue)
   - Value: 1,250,000,000 â‚« (VND format)
   - Color: #1890ff
   - Growth: +12.5% â†‘ (green arrow)
   - Label: "vs thÃ¡ng trÆ°á»›c"

2. **Sá»‘ ca chá»‘t**:

   - Icon: UserOutlined (green)
   - Value: 156
   - Color: #52c41a
   - Growth: +8.3% â†‘

3. **Doanh sá»‘ TB/ca**:

   - Value: 8,012,820 â‚«
   - Color: #722ed1 (purple)
   - Growth: +3.8% â†‘

4. **KhÃ¡ch má»›i vs CÅ©**:
   - Dual display:
     - Má»›i: 680,000,000 â‚« (green, size 16px)
     - CÅ©: 570,000,000 â‚« (blue, size 14px)
   - Growth: +18.2% (for new customers)

**Styling**:

- Card: `variant="borderless"`, shadow, border-radius 12px
- Title: 14px, color #8c8c8c
- Value: 28px, bold, color-coded
- Growth: 14px vá»›i arrow icon (up/down)

**Props**:

```typescript
interface KpiCardsProps {
  data: KpiData;
}
```

---

### 1.4 DailyRevenueChart Component

**File**: `src/features/reports/sales/components/DailyRevenueChart.tsx` âœ…

**Chart Type**: Line Chart (Chart.js)

**Features**:

- **Data**: 30 days cá»§a thÃ¡ng Ä‘Æ°á»£c chá»n
- **X-axis**: Dates (01-30)
- **Y-axis**: Revenue (VND)
- **Line**:
  - Color: #1890ff
  - Width: 2px
  - Smooth curve (tension: 0.4)
  - Gradient fill: rgba(24, 144, 255, 0.1)
- **Tooltip**:
  - Format: "NgÃ y DD: XXX,XXX,XXX â‚«"
  - Background: rgba(0,0,0,0.8)
- **Grid**: Y-axis only, dashed lines
- **Height**: 300px

**Card Wrapper**:

- Title: "Doanh sá»‘ theo ngÃ y" (16px, bold)
- Shadow vÃ  border radius

**Props**:

```typescript
interface DailyRevenueChartProps {
  data: DailyRevenueData[];
}
```

---

### 1.5 RevenueBySourceChart Component

**File**: `src/features/reports/sales/components/RevenueBySourceChart.tsx` âœ…

**Chart Type**: Pie Chart (Chart.js)

**Features**:

- **Data**: Top 5 customer sources
- **Colors**: Preset array
  - Facebook Ads: #1890ff
  - TikTok: #52c41a
  - Referral: #faad14
  - Walk-in: #f5222d
  - Sale Online: #722ed1
- **Legend**: Bottom position, horizontal
- **Labels**: Source name + percentage
- **Tooltip**: "XXX,XXX,XXX â‚« (XX%)"
- **Height**: 350px

**Card Wrapper**:

- Title: "CÆ¡ cáº¥u doanh sá»‘ theo nguá»“n"

**Props**:

```typescript
interface RevenueBySourceChartProps {
  data: RevenueBySourceData[];
}
```

---

### 1.6 RevenueByServiceBar Component

**File**: `src/features/reports/sales/components/RevenueByServiceBar.tsx` âœ…

**Chart Type**: Horizontal Bar Chart (Chart.js)

**Features**:

- **Data**: Top 5 services sorted by revenue desc
- **Orientation**: Horizontal (indexAxis: 'y')
- **Bars**:
  - Color: #1890ff
  - Border radius: 4px
- **X-axis**: Revenue (compact notation)
- **Y-axis**: Service names
- **Tooltip**: "Service: XXX,XXX,XXX â‚«"
- **Height**: 350px

**Card Wrapper**:

- Title: "Doanh sá»‘ theo dá»‹ch vá»¥"

**Props**:

```typescript
interface RevenueByServiceBarProps {
  data: RevenueByServiceData[];
}
```

---

### 1.7 SaleTable Component

**File**: `src/features/reports/sales/components/SaleTable.tsx` âœ…

**Table Type**: Ant Design Table

**Columns**:

| Column       | Width | Align  | Features                     |
| ------------ | ----- | ------ | ---------------------------- |
| Ranking      | 90px  | center | Tag with trophy icon (top 3) |
| Sale         | 160px | left   | Bold name, fixed column      |
| Ca Ä‘Æ°á»£c phÃ¢n | 120px | center | Number                       |
| Ca tÆ° váº¥n    | 110px | center | Number                       |
| Ca chá»‘t      | 100px | center | Green bold number            |
| Doanh sá»‘     | 140px | right  | Blue bold, sortable          |
| TB/ca        | 120px | right  | VND compact format           |
| Tá»· lá»‡ chá»‘t   | 110px | center | Progress bar (0-100%)        |

**Features**:

- Ranking colors: Gold (#1), Blue (#2), Green (#3), Default (others)
- Trophy icon cho top 3
- Sortable revenue column
- Scroll horizontal on mobile (scroll={{ x: 1000 }})
- No pagination (show all)

**Card Wrapper**:

- Title: "Hiá»‡u suáº¥t Sale tÆ° váº¥n"

**Props**:

```typescript
interface SaleTableProps {
  data: SalePerformanceData[];
}
```

---

### 1.8 TabsDetail Component

**File**: `src/features/reports/sales/components/TabsDetail.tsx` âœ…

**Tabs Type**: Ant Design Tabs vá»›i `type="card"`

**5 Tabs**:

#### Tab 1: Theo ngÃ y

**Columns**: NgÃ y | Ca Ä‘áº¿n | Ca tÆ° váº¥n | Ca chá»‘t | Doanh sá»‘ | GiÃ¡ trá»‹/ca | DV top | Sale top | BS top

- 30 rows (1 row/day)
- Pagination: 10 rows/page
- Doanh sá»‘: Blue bold

#### Tab 2: Theo nguá»“n

**Columns**: Nguá»“n | Ca Ä‘áº¿n | Ca tÆ° váº¥n | Ca chá»‘t | Doanh sá»‘ | ROI

- ROI: Tag color-coded (green â‰¥200%, yellow â‰¥100%, red <100%)
- 5-10 rows
- No pagination

#### Tab 3: Theo dá»‹ch vá»¥

**Columns**: NhÃ³m DV | Doanh sá»‘ | Ca chá»‘t | GiÃ¡ trá»‹ TB | ÄÃ³ng gÃ³p %

- Group by service category
- Sortable revenue
- Contribution percentage
- 5-8 rows

#### Tab 4: Theo sale tÆ° váº¥n

**Columns**: TÃªn | Ca phÃ¢n | Ca tÆ° váº¥n | Ca chá»‘t | Doanh sá»‘ | Tá»· lá»‡ chá»‘t % | DV chÃ­nh

- Same as SaleTable nhÆ°ng chi tiáº¿t hÆ¡n
- Main service column
- 10-15 rows

#### Tab 5: Theo bÃ¡c sÄ© tÆ° váº¥n

**Columns**: TÃªn | Ca tÆ° váº¥n | Ca Ä‘á»“ng Ã½ | Ca chá»‘t | Doanh sá»‘ | Tá»· lá»‡ Ä‘á»“ng Ã½ %

- Agreement rate calculation
- 8-12 rows

**Card Wrapper**:

- No title (tabs are self-explanatory)
- Full width table vá»›i scroll

**Props**:

```typescript
interface TabsDetailProps {
  data: DetailTabsData;
}
```

---

## 2. ğŸ“‹ TypeScript Types (ÄÃ£ Ä‘á»‹nh nghÄ©a)

**File**: `src/features/reports/sales/types.ts` âœ…

```typescript
// Main dashboard filters
export interface DashboardFilters {
  month: string | null; // "YYYY-MM"
  clinicId: string | null;
  saleId: string | null;
  doctorId: string | null;
}

// KPI metrics
export interface KpiData {
  totalSales: number;
  closedDeals: number;
  averagePerDeal: number;
  newCustomerRevenue: number;
  returningCustomerRevenue: number;
  salesGrowth: number; // percentage vs previous month
  dealsGrowth: number;
  averageGrowth: number;
  newCustomerGrowth: number;
}

// Chart data structures
export interface DailyRevenueData {
  date: string; // "01"-"30"
  revenue: number;
}

export interface RevenueBySourceData {
  source: string; // "Facebook Ads", "TikTok", etc.
  revenue: number;
}

export interface RevenueByServiceData {
  serviceName: string;
  revenue: number;
}

// Sales performance table
export interface SalePerformanceData {
  id: string;
  rank: number;
  saleName: string;
  assignedCases: number;
  consultedCases: number;
  closedCases: number;
  revenue: number;
  averagePerCase: number;
  closingRate: number; // percentage (0-100)
}

// Detail tabs data structures
export interface DailyDetailData {
  date: string;
  arrivals: number;
  consultations: number;
  closed: number;
  revenue: number;
  avgPerCase: number;
  topService: string;
  topSale: string;
  topDoctor: string;
}

export interface SourceDetailData {
  source: string;
  arrivals: number;
  consultations: number;
  closed: number;
  revenue: number;
  roi: number; // percentage
}

export interface ServiceDetailData {
  category: string;
  revenue: number;
  closed: number;
  avgValue: number;
  contribution: number; // percentage
}

export interface SaleDetailData {
  name: string;
  assigned: number;
  consulted: number;
  closed: number;
  revenue: number;
  closingRate: number;
  mainService: string;
}

export interface DoctorDetailData {
  name: string;
  consulted: number;
  agreed: number;
  closed: number;
  revenue: number;
  agreementRate: number; // percentage
}

export interface DetailTabsData {
  byDate: DailyDetailData[];
  bySource: SourceDetailData[];
  byService: ServiceDetailData[];
  bySale: SaleDetailData[];
  byDoctor: DoctorDetailData[];
}

// Main dashboard data aggregate
export interface DashboardData {
  kpi: KpiData;
  dailyRevenue: DailyRevenueData[];
  revenueBySource: RevenueBySourceData[];
  revenueByService: RevenueByServiceData[];
  salesPerformance: SalePerformanceData[];
  detailTabs: DetailTabsData;
}
```

---

## 3. ğŸ”„ Data Flow (Cáº§n triá»ƒn khai)

### 3.1 Current State (Mock Data)

```typescript
// mockData.ts âœ…
export const mockDashboardData: DashboardData = {
  kpi: {
    /* 9 metrics */
  },
  dailyRevenue: [
    /* 30 days */
  ],
  revenueBySource: [
    /* 5 sources */
  ],
  revenueByService: [
    /* 5 services */
  ],
  salesPerformance: [
    /* 4 sales */
  ],
  detailTabs: {
    byDate: [
      /* 30 days detail */
    ],
    bySource: [
      /* 5 sources detail */
    ],
    byService: [
      /* 5 categories */
    ],
    bySale: [
      /* 10 sales */
    ],
    byDoctor: [
      /* 8 doctors */
    ],
  },
};
```

### 3.2 Target State (API Integration)

**Endpoint**: `GET /api/reports/sales/dashboard`

**Query Params**:

```typescript
{
  month: string;          // "YYYY-MM" (required)
  clinicId?: string;      // optional filter
  saleId?: string;        // optional filter
  doctorId?: string;      // optional filter
}
```

**Response**: Same structure as `DashboardData` type

**Database Query Logic**:
