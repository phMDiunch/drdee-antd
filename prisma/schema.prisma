// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// src/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ===================================
//            MODELS
// ===================================

model Clinic {
  id String @id @default(uuid())

  // ThÃ´ng tin cÆ¡ báº£n
  clinicCode String    @unique // MÃ£ phÃ²ng khÃ¡m
  name       String    @unique // TÃªn phÃ²ng khÃ¡m
  address    String // Äá»‹a chá»‰ phÃ²ng khÃ¡m
  phone      String? // Sá»‘ Ä‘iá»‡n thoáº¡i liÃªn há»‡
  email      String? // Email liÃªn há»‡
  colorCode  String? // MÃ£ mÃ u Ä‘á»ƒ phÃ¢n biá»‡t phÃ²ng khÃ¡m trÃªn UI
  archivedAt DateTime? @db.Timestamptz // NgÃ y phÃ²ng khÃ¡m ngá»«ng hoáº¡t Ä‘á»™ng

  // Metadata
  createdAt DateTime @default(now()) @db.Timestamptz // NgÃ y táº¡o
  updatedAt DateTime @updatedAt @db.Timestamptz // NgÃ y cáº­p nháº­t cuá»‘i

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  employees Employee[]

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  customers Customer[]

  // LiÃªn káº¿t Ä‘áº¿n lá»‹ch háº¹n
  appointments Appointment[]

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultedServices ConsultedService[]

  // LiÃªn káº¿t Ä‘áº¿n nháº­t kÃ½ Ä‘iá»u trá»‹
  treatmentLogs TreatmentLog[]

  // LiÃªn káº¿t Ä‘áº¿n phiáº¿u thu
  paymentVouchers PaymentVoucher[]

  // LiÃªn káº¿t Ä‘áº¿n chÄƒm sÃ³c sau Ä‘iá»u trá»‹
  treatmentCares TreatmentCare[]
}

model Employee {
  id String @id @default(uuid())

  // ThÃ´ng tin tÃ i khoáº£n
  uid   String? @unique // User ID tá»« Supabase Auth Ä‘á»ƒ liÃªn káº¿t
  email String? @unique // Email Ä‘Äƒng nháº­p
  role  String // Vai trÃ² trong há»‡ thá»‘ng: "admin", "employee"

  // ThÃ´ng tin cÆ¡ báº£n
  fullName      String //
  dob           DateTime? @db.Date // NgÃ y sinh
  gender        String? // Giá»›i tÃ­nh
  avatarUrl     String? //
  favoriteColor String? // MÃ u yÃªu thÃ­ch Ä‘á»ƒ cÃ¡ nhÃ¢n hÃ³a giao diá»‡n

  // ThÃ´ng tin liÃªn há»‡
  phone          String? @unique
  currentAddress String? // Äá»‹a chá»‰ hiá»‡n táº¡i
  hometown       String? // QuÃª quÃ¡n

  // ThÃ´ng tin phÃ¡p lÃ½ & BH
  nationalId           String?   @unique // Sá»‘ CCCD
  nationalIdIssueDate  DateTime? @db.Date // NgÃ y cáº¥p
  nationalIdIssuePlace String? // NÆ¡i cáº¥p
  taxId                String?   @unique // MÃ£ sá»‘ thuáº¿
  insuranceNumber      String?   @unique // Sá»‘ sá»• BHXH

  // ThÃ´ng tin ngÃ¢n hÃ ng
  bankAccountNumber String? // Sá»‘ tÃ i khoáº£n ngÃ¢n hÃ ng
  bankName          String? // TÃªn ngÃ¢n hÃ ng

  // ThÃ´ng tin cÃ´ng viá»‡c
  employeeCode   String? @unique // MÃ£ nhÃ¢n viÃªn
  employeeStatus String? // "Äang lÃ m viá»‡c", "Nghá»‰ viá»‡c"
  clinicId       String? // ID cá»§a phÃ²ng khÃ¡m lÃ m viá»‡c
  department     String? // PhÃ²ng ban
  team           String? // Bá»™ pháº­n
  jobTitle       String? // Chá»©c danh
  positionTitle  String? // Chá»©c vá»¥

  // Metadata
  createdById String? // ID cá»§a ngÆ°á»i táº¡o
  updatedById String? // ID cá»§a ngÆ°á»i cáº­p nháº­t cuá»‘i

  createdAt DateTime @default(now()) @db.Timestamptz
  updatedAt DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  createdBy        Employee?  @relation("CreatedEmployees", fields: [createdById], references: [id])
  updatedBy        Employee?  @relation("UpdatedEmployees", fields: [updatedById], references: [id])
  createdEmployees Employee[] @relation("CreatedEmployees")
  updatedEmployees Employee[] @relation("UpdatedEmployees")

  // LiÃªn káº¿t Ä‘áº¿n phÃ²ng khÃ¡m
  clinic Clinic? @relation(fields: [clinicId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  createdCustomers Customer[] @relation("CreatedCustomers")
  updatedCustomers Customer[] @relation("UpdatedCustomers")

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ nha khoa
  createdDentalServices DentalService[] @relation("CreatedDentalServices")
  updatedDentalServices DentalService[] @relation("UpdatedDentalServices")

  // LiÃªn káº¿t Ä‘áº¿n lá»‹ch háº¹n
  primaryDentistAppointments   Appointment[] @relation("PrimaryDentistAppointments")
  secondaryDentistAppointments Appointment[] @relation("SecondaryDentistAppointments")
  createdAppointments          Appointment[] @relation("CreatedAppointments")
  updatedAppointments          Appointment[] @relation("UpdatedAppointments")

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultingDoctorServices ConsultedService[] @relation("ConsultingDoctorServices")
  consultingSaleServices   ConsultedService[] @relation("ConsultingSaleServices")
  treatingDoctorServices   ConsultedService[] @relation("TreatingDoctorServices")
  createdConsultedServices ConsultedService[] @relation("CreatedConsultedServices")
  updatedConsultedServices ConsultedService[] @relation("UpdatedConsultedServices")

  // LiÃªn káº¿t Ä‘áº¿n nháº­t kÃ½ Ä‘iá»u trá»‹
  dentistLogs    TreatmentLog[] @relation("DentistLogs")
  assistant1Logs TreatmentLog[] @relation("Assistant1Logs")
  assistant2Logs TreatmentLog[] @relation("Assistant2Logs")
  createdLogs    TreatmentLog[] @relation("CreatedLogs")
  updatedLogs    TreatmentLog[] @relation("UpdatedLogs")

  // LiÃªn káº¿t Ä‘áº¿n phiáº¿u thu
  cashierVouchers PaymentVoucher[] @relation("CashierVouchers")
  createdVouchers PaymentVoucher[] @relation("CreatedVouchers")
  updatedVouchers PaymentVoucher[] @relation("UpdatedVouchers")

  // LiÃªn káº¿t Ä‘áº¿n chi tiáº¿t phiáº¿u thu
  createdVoucherDetails PaymentVoucherDetail[] @relation("CreatedVoucherDetails")

  // LiÃªn káº¿t Ä‘áº¿n chÄƒm sÃ³c sau Ä‘iá»u trá»‹ (aftercare)
  careStaffTreatmentCares TreatmentCare[]
  createdTreatmentCares   TreatmentCare[] @relation("CreatedTreatmentCares")
  updatedTreatmentCares   TreatmentCare[] @relation("UpdatedTreatmentCares")

  // LiÃªn káº¿t Ä‘áº¿n nhÃ  cung cáº¥p
  createdSuppliers Supplier[] @relation("CreatedSuppliers")
  updatedSuppliers Supplier[] @relation("UpdatedSuppliers")

  // LiÃªn káº¿t Ä‘áº¿n váº­t tÆ°
  createdMaterials Material[] @relation("CreatedMaterials")
  updatedMaterials Material[] @relation("UpdatedMaterials")

  // LiÃªn káº¿t Ä‘áº¿n danh má»¥c labo
  createdLaboItems LaboItem[] @relation("CreatedLaboItems")
  updatedLaboItems LaboItem[] @relation("UpdatedLaboItems")

  // ğŸš€ Performance Indexes
  @@index([clinicId, employeeStatus]) // Optimize: Get working employees by clinic
  @@index([email]) // Optimize: Login by email
}

model DentalService {
  id String @id @default(uuid())

  // ThÃ´ng tin cÆ¡ báº£n
  name        String  @unique // TÃªn dá»‹ch vá»¥, vÃ­ dá»¥: "Cáº¡o vÃ´i rÄƒng"
  description String? // MÃ´ táº£ chi tiáº¿t

  // ThÃ´ng tin phÃ¢n loáº¡i
  serviceGroup String? // NhÃ³m dá»‹ch vá»¥, vÃ­ dá»¥: niá»ng rÄƒng invisalign, niá»ng rÄƒng máº¯c cÃ i
  department   String? // Bá»™ mÃ´n, vÃ­ dá»¥: niá»ng rÄƒng invisalign moderate, niá»ng rÄƒng invisalign comprehensive
  tags         String[] @default([]) // CÃ¡c tháº» (tags) Ä‘á»ƒ phÃ¢n loáº¡i dá»‹ch vá»¥ do phÃ²ng khÃ¡m tá»± Ä‘á»‹nh nghÄ©a

  // ThÃ´ng tin giÃ¡ & Ä‘Æ¡n vá»‹
  unit     String // ÄÆ¡n vá»‹ tÃ­nh: "RÄƒng", "HÃ m", "Láº§n"
  price    Int // GiÃ¡ niÃªm yáº¿t, lÆ°u dáº¡ng Int Ä‘á»ƒ trÃ¡nh sai sá»‘
  minPrice Int? // GiÃ¡ tá»‘i thiá»ƒu (náº¿u cÃ³)

  // ThÃ´ng tin chi tiáº¿t & báº£o hÃ nh
  officialWarranty     String? // Báº£o hÃ nh chÃ­nh hÃ£ng
  clinicWarranty       String? // Báº£o hÃ nh uy tÃ­n tá»« phÃ²ng khÃ¡m
  origin               String? // Xuáº¥t xá»©
  avgTreatmentMinutes  Int? // Sá»‘ phÃºt Ä‘iá»u trá»‹ trung bÃ¬nh
  avgTreatmentSessions Int? // Sá»‘ buá»•i Ä‘iá»u trá»‹ trung bÃ¬nh

  // Metadata
  archivedAt DateTime? @db.Timestamptz // NgÃ y dá»‹ch vá»¥ ngá»«ng hoáº¡t Ä‘á»™ng
  createdAt  DateTime  @default(now()) @db.Timestamptz // NgÃ y táº¡o
  updatedAt  DateTime  @updatedAt @db.Timestamptz // NgÃ y cáº­p nháº­t cuá»‘i

  createdById String // ID cá»§a ngÆ°á»i táº¡o
  updatedById String // ID cá»§a ngÆ°á»i cáº­p nháº­t

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  createdBy Employee @relation("CreatedDentalServices", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedDentalServices", fields: [updatedById], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultedServices ConsultedService[]
}

model Customer {
  id String @id @default(uuid())

  // ThÃ´ng tin cÆ¡ báº£n
  fullName String // Há» tÃªn
  dob      DateTime? @db.Date // NgÃ y sinh
  gender   String? // Giá»›i tÃ­nh

  // ThÃ´ng tin liÃªn há»‡
  phone    String? @unique // Sá»‘ Ä‘iá»‡n thoáº¡i
  email    String? @unique
  address  String? // Äá»‹a chá»‰
  city     String? // Tá»‰nh/ThÃ nh phá»‘
  district String? // Quáº­n/Huyá»‡n

  primaryContactRole String? // Vai trÃ² ngÆ°á»i liÃªn há»‡: Bá»‘, Máº¹, Con, Vá»£, Chá»“ng...
  primaryContactId   String? // ID cá»§a ngÆ°á»i liÃªn há»‡ chÃ­nh

  // ThÃ´ng tin phÃ¢n loáº¡i
  customerCode String? @unique // MÃ£ khÃ¡ch hÃ ng
  clinicId     String? // Chi nhÃ¡nh

  occupation        String? // Nghá» nghiá»‡p
  source            String? // Nguá»“n khÃ¡ch
  sourceNotes       String? // Ghi chÃº nguá»“n
  serviceOfInterest String? // Dá»‹ch vá»¥ quan tÃ¢m (má»™t giÃ¡ trá»‹ duy nháº¥t)

  // Metadata  
  createdById String // ID cá»§a ngÆ°á»i táº¡o
  updatedById String // ID cá»§a ngÆ°á»i cáº­p nháº­t cuá»‘i
  createdAt   DateTime @default(now()) @db.Timestamptz
  updatedAt   DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n chi nhÃ¡nh
  clinic Clinic? @relation(fields: [clinicId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  primaryContact Customer?  @relation("PrimaryContactDependents", fields: [primaryContactId], references: [id])
  dependents     Customer[] @relation("PrimaryContactDependents")

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  createdBy Employee @relation("CreatedCustomers", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedCustomers", fields: [updatedById], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n lá»‹ch háº¹n
  appointments Appointment[]

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultedServices ConsultedService[]

  // LiÃªn káº¿t Ä‘áº¿n nháº­t kÃ½ Ä‘iá»u trá»‹
  treatmentLogs TreatmentLog[]

  // LiÃªn káº¿t Ä‘áº¿n phiáº¿u thu
  paymentVouchers PaymentVoucher[]

  // LiÃªn káº¿t Ä‘áº¿n chÄƒm sÃ³c sau Ä‘iá»u trá»‹ (aftercare)
  treatmentCares TreatmentCare[]

  // ğŸš€ Performance Indexes
  @@index([clinicId, createdAt]) // Optimize: Daily view - customers by clinic & date
  @@index([phone]) // Optimize: Search by phone number
}

model Appointment {
  id String @id @default(uuid())

  // ThÃ´ng tin cÆ¡ báº£n
  customerId          String // ID khÃ¡ch hÃ ng
  appointmentDateTime DateTime @db.Timestamptz // Thá»i gian háº¹n chÃ­nh xÃ¡c (ngÃ y vÃ  giá»)
  duration            Int      @default(30) // Thá»i lÆ°á»£ng cuá»™c háº¹n tÃ­nh báº±ng phÃºt, máº·c Ä‘á»‹nh lÃ  30 phÃºt
  notes               String? // Ná»™i dung, ghi chÃº cho cuá»™c háº¹n

  // ThÃ´ng tin phÃ¢n cÃ´ng
  primaryDentistId   String // BÃ¡c sÄ© chÃ­nh (báº¯t buá»™c)
  secondaryDentistId String? // BÃ¡c sÄ© phá»¥ (khÃ´ng báº¯t buá»™c)
  clinicId           String // Chi nhÃ¡nh diá»…n ra cuá»™c háº¹n

  // Tráº¡ng thÃ¡i & Check-in
  status       String // "Chá» xÃ¡c nháº­n", "ÄÃ£ xÃ¡c nháº­n", "ÄÃ£ Ä‘áº¿n", "KhÃ´ng Ä‘áº¿n", "ÄÃ£ há»§y"
  checkInTime  DateTime? @db.Timestamptz // Thá»i gian khÃ¡ch hÃ ng check-in thá»±c táº¿
  checkOutTime DateTime? @db.Timestamptz // Thá»i gian khÃ¡ch hÃ ng check-out

  // Metadata
  createdById String
  updatedById String

  createdAt DateTime @default(now()) @db.Timestamptz
  updatedAt DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n chi nhÃ¡nh
  clinic Clinic @relation(fields: [clinicId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  customer Customer @relation(fields: [customerId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  primaryDentist   Employee  @relation("PrimaryDentistAppointments", fields: [primaryDentistId], references: [id])
  secondaryDentist Employee? @relation("SecondaryDentistAppointments", fields: [secondaryDentistId], references: [id])
  createdBy        Employee  @relation("CreatedAppointments", fields: [createdById], references: [id])
  updatedBy        Employee  @relation("UpdatedAppointments", fields: [updatedById], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultedServices ConsultedService[]

  // LiÃªn káº¿t Ä‘áº¿n nháº­t kÃ½ Ä‘iá»u trá»‹
  treatmentLogs TreatmentLog[]

  // ğŸš€ Performance Indexes
  @@index([clinicId, appointmentDateTime]) // Optimize: Daily view - appointments by clinic & date
  @@index([customerId]) // Optimize: Customer detail - all appointments
  @@index([primaryDentistId]) // Optimize: Dentist schedule
}

model ConsultedService {
  id String @id @default(uuid())

  // LiÃªn káº¿t Dá»¯ liá»‡u
  customerId      String // KhÃ¡ch hÃ ng
  appointmentId   String // Lá»‹ch háº¹n tÆ° váº¥n 
  dentalServiceId String // Dá»‹ch vá»¥ tÆ° váº¥n
  clinicId        String // Chi nhÃ¡nh diá»…n ra tÆ° váº¥n

  // Dá»¯ liá»‡u Sao chÃ©p (Denormalized)
  // Giá»¯ lá»‹ch sá»­ giÃ¡ vÃ  tÃªn táº¡i thá»i Ä‘iá»ƒm tÆ° váº¥n
  consultedServiceName String // Sao chÃ©p tÃªn dá»‹ch vá»¥ táº¡i thá»i Ä‘iá»ƒm tÆ° váº¥n
  consultedServiceUnit String // Sao chÃ©p Ä‘Æ¡n vá»‹ tÃ­nh
  price                Int // GiÃ¡ niÃªm yáº¿t gá»‘c

  // ThÃ´ng tin Äiá»u trá»‹ Chi tiáº¿t
  toothPositions String[] // Máº£ng vá»‹ trÃ­ rÄƒng, vÃ­ dá»¥: ["R16", "R26"]
  specificStatus String? // Ghi chÃº cá»§a bÃ¡c sÄ© vá» tÃ¬nh tráº¡ng

  // ThÃ´ng tin TÃ i chÃ­nh
  quantity          Int @default(1) // Sá»‘ lÆ°á»£ng
  preferentialPrice Int // GiÃ¡ Æ°u Ä‘Ã£i cho 1 Ä‘Æ¡n vá»‹
  finalPrice        Int // ThÃ nh tiá»n = preferentialPrice * quantity
  amountPaid        Int @default(0) // Sá»‘ tiá»n Ä‘Ã£ tráº£ cho dá»‹ch vá»¥ nÃ y
  debt              Int // CÃ´ng ná»£ cÃ²n láº¡i

  // Tráº¡ng thÃ¡i & NgÃ y quan trá»ng
  consultationDate   DateTime  @default(now()) @db.Timestamptz // NgÃ y tÆ° váº¥n
  serviceConfirmDate DateTime? @db.Timestamptz // NgÃ y khÃ¡ch hÃ ng Ä‘á»“ng Ã½
  serviceStatus      String    @default("ChÆ°a chá»‘t") // "ChÆ°a chá»‘t", "ÄÃ£ chá»‘t"
  treatmentStatus    String    @default("ChÆ°a Ä‘iá»u trá»‹") // "ChÆ°a Ä‘iá»u trá»‹", "Äang Ä‘iá»u trá»‹", "HoÃ n thÃ nh"

  // ThÃ´ng tin PhÃ¢n cÃ´ng
  consultingDoctorId String?
  consultingSaleId   String?
  treatingDoctorId   String?

  // Metadata
  createdById String
  updatedById String

  createdAt DateTime @default(now()) @db.Timestamptz
  updatedAt DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  customer Customer @relation(fields: [customerId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ nha khoa
  dentalService DentalService @relation(fields: [dentalServiceId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n lá»‹ch háº¹n
  Appointment Appointment? @relation(fields: [appointmentId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n chi nhÃ¡nh
  clinic Clinic @relation(fields: [clinicId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  consultingDoctor Employee? @relation("ConsultingDoctorServices", fields: [consultingDoctorId], references: [id])
  consultingSale   Employee? @relation("ConsultingSaleServices", fields: [consultingSaleId], references: [id])
  treatingDoctor   Employee? @relation("TreatingDoctorServices", fields: [treatingDoctorId], references: [id])

  createdBy Employee @relation("CreatedConsultedServices", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedConsultedServices", fields: [updatedById], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n nháº­t kÃ½ Ä‘iá»u trá»‹
  treatmentLogs TreatmentLog[]

  // LiÃªn káº¿t Ä‘áº¿n phiáº¿u thu chi tiáº¿t
  paymentDetails PaymentVoucherDetail[]
}

model PaymentVoucher {
  id String @id @default(uuid())

  paymentNumber String   @unique // Sá»‘ phiáº¿u thu
  customerId    String // KhÃ¡ch hÃ ng
  paymentDate   DateTime @default(now()) @db.Timestamptz // NgÃ y vÃ  giá» thu tiá»n
  totalAmount   Int // Tá»•ng tiá»n cá»§a cáº£ phiáº¿u thu
  notes         String? // Ná»™i dung thu tiá»n: Äáº·t cá»c, Thanh toÃ¡n tiáº¿p, HoÃ n táº¥t thanh toÃ¡n
  cashierId     String // NhÃ¢n viÃªn thu tiá»n
  clinicId      String // Chi nhÃ¡nh thá»±c hiá»‡n thu tiá»n

  // Metadata
  createdById String
  updatedById String
  createdAt   DateTime @default(now()) @db.Timestamptz
  updatedAt   DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n chi tiáº¿t phiáº¿u thu
  details PaymentVoucherDetail[]

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  customer Customer @relation(fields: [customerId], references: [id])
  // LiÃªn káº¿t Ä‘áº¿n chi nhÃ¡nh
  clinic   Clinic   @relation(fields: [clinicId], references: [id])
  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  cashier  Employee @relation("CashierVouchers", fields: [cashierId], references: [id])

  createdBy Employee @relation("CreatedVouchers", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedVouchers", fields: [updatedById], references: [id])

  // Indexes
  @@index([clinicId, paymentDate])
  @@index([customerId])
  @@index([paymentNumber])
}

model PaymentVoucherDetail {
  id String @id @default(uuid())

  // LiÃªn káº¿t ngÆ°á»£c láº¡i vá»›i phiáº¿u thu chÃ­nh
  paymentVoucherId String
  paymentVoucher   PaymentVoucher @relation(fields: [paymentVoucherId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ Ä‘Æ°á»£c thanh toÃ¡n
  consultedServiceId String
  consultedService   ConsultedService @relation(fields: [consultedServiceId], references: [id])

  amount        Int // Sá»‘ tiá»n thanh toÃ¡n cho dÃ²ng nÃ y
  paymentMethod String // HÃ¬nh thá»©c thanh toÃ¡n: "Tiá»n máº·t", "Quáº¹t tháº»",...

  // Metadata
  createdAt   DateTime @default(now()) @db.Timestamptz
  createdById String

  // 
  createdBy Employee @relation("CreatedVoucherDetails", fields: [createdById], references: [id])

  // Indexes
  @@index([consultedServiceId])
  @@index([paymentVoucherId])
}

model TreatmentLog {
  id String @id @default(uuid())

  // LiÃªn káº¿t Dá»¯ liá»‡u
  customerId         String
  consultedServiceId String // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ cá»¥ thá»ƒ Ä‘Ã£ Ä‘Æ°á»£c chá»‘t
  appointmentId      String // Lá»‹ch háº¹n cá»§a buá»•i Ä‘iá»u trá»‹ nÃ y

  // ThÃ´ng tin LÃ¢m sÃ ng
  treatmentDate   DateTime @default(now()) @db.Timestamptz // NgÃ y Ä‘iá»u trá»‹
  treatmentNotes  String // Chi tiáº¿t, ná»™i dung Ä‘iá»u trá»‹
  nextStepNotes   String? // Káº¿ hoáº¡ch cho buá»•i háº¹n tiáº¿p theo
  treatmentStatus String // "Äang tiáº¿n hÃ nh", "HoÃ n táº¥t bÆ°á»›c", "HoÃ n táº¥t dá»‹ch vá»¥"

  imageUrls String[] // Máº£ng chá»©a cÃ¡c URL cá»§a hÃ¬nh áº£nh
  xrayUrls  String[] // Máº£ng chá»©a cÃ¡c URL cá»§a phim X-quang

  // NhÃ¢n sá»± thá»±c hiá»‡n
  dentistId    String
  assistant1Id String?
  assistant2Id String?
  clinicId     String

  // Metadata & Ghi nháº­n
  createdById String
  updatedById String

  createdAt DateTime @default(now()) @db.Timestamptz
  updatedAt DateTime @updatedAt @db.Timestamptz

  // LiÃªn káº¿t Ä‘áº¿n khÃ¡ch hÃ ng
  customer Customer @relation(fields: [customerId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n dá»‹ch vá»¥ tÆ° váº¥n
  consultedService ConsultedService @relation(fields: [consultedServiceId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n lá»‹ch háº¹n
  appointment Appointment? @relation(fields: [appointmentId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n chi nhÃ¡nh
  clinic Clinic @relation(fields: [clinicId], references: [id])

  // LiÃªn káº¿t Ä‘áº¿n nhÃ¢n viÃªn
  dentist    Employee  @relation("DentistLogs", fields: [dentistId], references: [id])
  assistant1 Employee? @relation("Assistant1Logs", fields: [assistant1Id], references: [id])
  assistant2 Employee? @relation("Assistant2Logs", fields: [assistant2Id], references: [id])
  createdBy  Employee  @relation("CreatedLogs", fields: [createdById], references: [id])
  updatedBy  Employee  @relation("UpdatedLogs", fields: [updatedById], references: [id])
}

//---------------------------
// TreatmentCare (Aftercare) v1
//---------------------------

model TreatmentCare {
  id String @id @default(uuid())

  // LiÃªn káº¿t
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])

  // CÆ¡ sá»Ÿ bÃ¡o cÃ¡o: theo nhÃ¢n viÃªn chÄƒm sÃ³c (careStaff)
  clinicId String
  clinic   Clinic @relation(fields: [clinicId], references: [id])

  careStaffId String
  careStaff   Employee @relation(fields: [careStaffId], references: [id])

  // NgÃ y nghiá»‡p vá»¥
  treatmentDate DateTime @db.Date // NgÃ y Ä‘iá»u trá»‹ (Date-only)
  careAt        DateTime @db.Timestamptz // Thá»i Ä‘iá»ƒm chÄƒm sÃ³c

  // Ná»™i dung & Tráº¡ng thÃ¡i
  careContent String
  careStatus  String

  // Snapshot (gá»™p theo treatmentDate)
  treatmentServiceNames String[]
  treatingDoctorNames   String[]
  treatingDoctorIds     String[]
  treatmentClinicIds    String[]

  // Audit
  createdById String
  updatedById String
  createdAt   DateTime @default(now()) @db.Timestamptz
  updatedAt   DateTime @updatedAt @db.Timestamptz

  createdBy Employee @relation("CreatedTreatmentCares", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedTreatmentCares", fields: [updatedById], references: [id])

  // Indexes
  @@index([clinicId, treatmentDate])
  @@index([clinicId, careAt])
  @@index([careStaffId, careAt])
  @@index([customerId, treatmentDate])
}

//---------------------------
// MasterData (Shared across app)
//---------------------------

model MasterData {
  id String @id @default(uuid())

  // PhÃ¢n loáº¡i & Äá»‹nh danh
  category    String // NhÃ³m phÃ¢n loáº¡i (slug: 'bao-hanh-chinh-hang')
  key         String // MÃ£ Ä‘á»‹nh danh (slug: '1-nam') - IMMUTABLE
  value       String // TÃªn hiá»ƒn thá»‹ ('1 nÄƒm') - MUTABLE
  description String? // MÃ´ táº£ chi tiáº¿t (optional)

  // Audit
  createdAt DateTime @default(now()) @db.Timestamptz
  updatedAt DateTime @updatedAt @db.Timestamptz

  // Indexes
  @@unique([category, key]) // Unique constraint: key chá»‰ unique trong category
  @@index([category]) // Fast filter by category
}

//---------------------------
// Supplier (NhÃ  cung cáº¥p)
//---------------------------

model Supplier {
  id        String  @id @default(uuid())
  name      String  @unique
  shortName String?

  // Store MasterData.key (String), NOT id (UUID)
  // NO FK relation â†’ Allows MasterData to be deleted
  // Frontend: Display MasterData.value if found, else display key itself
  supplierGroup String? // e.g., 'ncc-chinh', 'ncc-phu'

  phone   String?
  email   String?
  address String?
  taxCode String?
  note    String?

  archivedAt DateTime? @db.Timestamptz // Soft delete
  createdAt  DateTime  @default(now()) @db.Timestamptz
  updatedAt  DateTime  @updatedAt @db.Timestamptz

  createdById String // ID cá»§a ngÆ°á»i táº¡o
  updatedById String // ID cá»§a ngÆ°á»i cáº­p nháº­t

  createdBy Employee @relation("CreatedSuppliers", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedSuppliers", fields: [updatedById], references: [id])

  // Relations (uncomment when GoodsReceipt model is implemented)
  // goodsReceipts GoodsReceipt[]

  // Indexes
  @@index([name])
  @@index([supplierGroup, archivedAt])
}

//---------------------------
// Material (Váº­t tÆ°)
//---------------------------

model Material {
  id          String  @id @default(uuid())
  code        String  @unique // MAT0001, MAT0002... (Tá»± sinh)
  name        String  @unique
  description String? // MÃ´ táº£, quy cÃ¡ch Ä‘Ã³ng gÃ³i

  // Store MasterData.key (String), NOT id (UUID)
  // NO FK relation â†’ Allows MasterData to be deleted
  // Frontend: Display MasterData.value if found, else display key itself
  unit         String // ÄÆ¡n vá»‹ tÃ­nh (category='don-vi-tinh') - Required
  materialType String // Loáº¡i váº­t tÆ° (category='loai-vat-tu') - Required
  department   String // Bá»™ mÃ´n (category='bo-mon') - Required
  category     String? // NhÃ³m váº­t tÆ° (category='nhom-vat-tu')
  subCategory  String? // PhÃ¢n nhÃ³m (category='phan-nhom-vat-tu')

  minStockLevel Int? // Má»©c tá»“n kho tá»‘i thiá»ƒu
  imageUrl      String? // URL hÃ¬nh áº£nh
  tags          String[] @default([]) // Array of MasterData keys (category='tag-vat-tu')

  archivedAt DateTime? @db.Timestamptz // Soft delete
  createdAt  DateTime  @default(now()) @db.Timestamptz
  updatedAt  DateTime  @updatedAt @db.Timestamptz

  createdById String // ID cá»§a ngÆ°á»i táº¡o
  updatedById String // ID cá»§a ngÆ°á»i cáº­p nháº­t

  createdBy Employee @relation("CreatedMaterials", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedMaterials", fields: [updatedById], references: [id])

  // Relations (placeholder - sáº½ Ä‘Æ°á»£c thÃªm khi implement Goods Receipt/Issue)
  // receiptDetails  GoodsReceiptDetail[]
  // issueDetails    GoodsIssueDetail[]
  // stockQuants     StockQuant[]

  // Indexes
  @@index([code])
  @@index([name])
  @@index([materialType, department, category, archivedAt])
  @@index([tags]) // GIN index for array search in PostgreSQL
}

//---------------------------
// LaboItem (Danh má»¥c rÄƒng giáº£)
//---------------------------

model LaboItem {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?

  // Store MasterData.key (String), NOT id (UUID)
  // NO FK relation â†’ Allows MasterData to be deleted
  // Frontend: Display MasterData.value if found, else display key itself
  serviceGroup String // NhÃ³m dá»‹ch vá»¥ labo (category='nhom-dich-vu-labo')
  unit         String // ÄÆ¡n vá»‹ tÃ­nh (category='don-vi-tinh-labo')

  archivedAt DateTime? @db.Timestamptz // Soft delete
  createdAt  DateTime  @default(now()) @db.Timestamptz
  updatedAt  DateTime  @updatedAt @db.Timestamptz

  createdById String // ID cá»§a ngÆ°á»i táº¡o
  updatedById String // ID cá»§a ngÆ°á»i cáº­p nháº­t

  createdBy Employee @relation("CreatedLaboItems", fields: [createdById], references: [id])
  updatedBy Employee @relation("UpdatedLaboItems", fields: [updatedById], references: [id])

  // Relations (placeholder - sáº½ Ä‘Æ°á»£c thÃªm khi implement Supplier Labo Price vÃ  Labo Order)
  // supplierPrices SupplierLaboPrice[]
  // orders         LaboOrder[]

  // Indexes
  @@index([name])
  @@index([serviceGroup, archivedAt])
}
